<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/archives/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/archives/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/archives/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/archives/favicon.ico?v=5.1.2" />






<meta name="description" content="记录才能走得更远...">
<meta property="og:type" content="website">
<meta property="og:title" content="Activeliang&#39;s Blog">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="Activeliang&#39;s Blog">
<meta property="og:description" content="记录才能走得更远...">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Activeliang&#39;s Blog">
<meta name="twitter:description" content="记录才能走得更远...">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/archives/',
    scheme: 'Pisces',
    version: '5.1.2',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/2/"/>





  <title>Activeliang's Blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/archives/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Activeliang's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">黄鸿亮的博客</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            目录
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/archives/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/archives/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/archives/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/archives/2017/08/03/2017-08-03-the-front-half-of-the-ruby-on-rails-guides-extraction/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="黄鸿亮">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://olmrxx9ks.bkt.clouddn.com/2017-09-07-080115.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Activeliang's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/archives/2017/08/03/2017-08-03-the-front-half-of-the-ruby-on-rails-guides-extraction/" itemprop="url">《ruby on rails guides》前半部分提取</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-03T01:29:00+08:00">
                2017-08-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>[TOC]</p>
<h4 id="新手入门"><a href="#新手入门" class="headerlink" title="新手入门"></a>新手入门</h4><ol>
<li><p>Form_for表单助手：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>New Article<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">%=</span> <span class="attr">form_for</span> <span class="attr">:article</span>, <span class="attr">url:</span> <span class="attr">articles_path</span> <span class="attr">do</span> |<span class="attr">f</span>| %&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">%=</span> <span class="attr">f.label</span> <span class="attr">:title</span> %&gt;</span> <span class="tag">&lt;<span class="name">br</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">%=</span> <span class="attr">f.text_field</span> <span class="attr">:title</span> %&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">%=</span> <span class="attr">f.label</span> <span class="attr">:text</span> %&gt;</span> <span class="tag">&lt;<span class="name">br</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">%=</span> <span class="attr">f.text_area</span> <span class="attr">:text</span> %&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">%=</span> <span class="attr">f.submit</span> %&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">%</span> <span class="attr">end</span> %&gt;</span></div></pre></td></tr></table></figure>
<ul>
<li><p><code>url: articles_path</code> 可以指定路由</p>
</li>
<li><p>用下面这个语句可以直接返回字符形式得知params:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">create</span></span></div><div class="line">  render <span class="symbol">plain:</span> params[<span class="symbol">:article</span>].inspect</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>CRUD的常规顺序：</p>
<ul>
<li>index</li>
<li>show</li>
<li>new</li>
<li>edit</li>
<li>create</li>
<li>update</li>
<li>destroy</li>
</ul>
</li>
<li><p>Link_to方法还可以这样用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;%= link_to &apos;New Blog&apos;, controller: &apos;articles&apos; %&gt;</div></pre></td></tr></table></figure>
</li>
<li><p><code>pluralize方法</code>一个rails内建的方法，超过1会自动转换成复数形式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;%= pluralize(@article.errors.count, &quot;error&quot;) %&gt;</div></pre></td></tr></table></figure>
</li>
<li><p>原来rails内置了一个身份验证器，可以很方便地使用起来！：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">http_basic_authenticate_with name: &quot;dhh&quot;, password: &quot;secret&quot;, except: [:index, :show]</div></pre></td></tr></table></figure>
<p>在controller里增加一条这样的语句就可以了，效果：<img src="http://olmrxx9ks.bkt.clouddn.com/2017-07-26-051603.jpg" alt=""></p>
<p>超级棒，在开发的时候，或者只需要一人的管理系统上这是很方便的！</p>
</li>
</ol>
<h4 id="Active-Record基础"><a href="#Active-Record基础" class="headerlink" title="Active Record基础"></a>Active Record基础</h4><ol>
<li><p>更新一个栏位：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">user = User.find_by(name: &apos;David&apos;)</div><div class="line">user.update(name: &apos;Dave&apos;)</div></pre></td></tr></table></figure>
<p>就搞定了，比我之前的要简单一点。</p>
</li>
</ol>
<h4 id="Active-Record迁移"><a href="#Active-Record迁移" class="headerlink" title="Active Record迁移"></a>Active Record迁移</h4><ol>
<li><p>如何让migration文件自动生成栏位：(按以下这种格式)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">rails g migration add_title_to_products title:string</div><div class="line">rails g migration remove_title_from_products title:string</div></pre></td></tr></table></figure>
</li>
<li><p>migration 中还有另外一个关于修改默认值的方法：</p>
<ul>
<li><code>change_column_default</code></li>
<li><code>change_column_null</code></li>
</ul>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">change_column_null <span class="symbol">:products</span>, <span class="symbol">:name</span>, <span class="literal">false</span>   (设置这个字段不能空)</div><div class="line">change_column_default <span class="symbol">:users</span>, <span class="symbol">:is_admin</span>, <span class="symbol">from:</span> <span class="literal">false</span>, <span class="symbol">to:</span> <span class="literal">true</span></div></pre></td></tr></table></figure>
</li>
<li><p>字体修饰符：</p>
<ul>
<li><code>limit</code> 修饰符：设置 <code>string/text/binary/integer</code> 字段的最大长度。</li>
<li><code>precision</code> 修饰符：定义 <code>decimal</code> 字段的精度，表示数字的总位数。</li>
<li><code>scale</code> 修饰符：定义 <code>decimal</code> 字段的标度，表示小数点后的位数。</li>
<li><code>polymorphic</code> 修饰符：为 <code>belongs_to</code> 关联添加 <code>type</code> 字段。</li>
<li><code>null</code> 修饰符：设置字段能否为 <code>NULL</code> 值。</li>
<li><code>default</code> 修饰符：设置字段的默认值。请注意，如果使用动态值（如日期）作为默认值，那么默认值只会在第一次使时（如应用迁移的日期）计算一次。</li>
<li><code>index</code> 修饰符：为字段添加索引。</li>
<li><code>comment</code> 修饰符：为字段添加注释。</li>
</ul>
</li>
<li><p>回滚</p>
<ul>
<li><code>rails db:rollback</code></li>
<li><code>rails db:rollback  STEP=3</code>回滚三步</li>
<li><code>rails db:migration:redo</code>重做最后一个步骤，</li>
<li><code>rails db:migration:redo STEP=3</code>重做最后有一个步骤。</li>
</ul>
</li>
<li><p>重置数据库</p>
<ul>
<li><code>rake db:reset</code></li>
</ul>
</li>
</ol>
<h4 id="Active-Record数据验证"><a href="#Active-Record数据验证" class="headerlink" title="Active Record数据验证"></a>Active Record数据验证</h4><ol>
<li><p><code>.new_record?</code> 判断对象是否已经存入数据库。</p>
</li>
<li><p>下面的方法会触发验证：</p>
<ul>
<li><code>create</code></li>
<li><code>create!</code></li>
<li><code>save</code></li>
<li><code>save!</code></li>
<li><code>update</code></li>
<li><code>update!</code></li>
</ul>
</li>
<li><p>下面的方法会跳过验证：</p>
<ul>
<li><code>decrement!</code></li>
<li><code>decrement_counter</code></li>
<li><code>increment!</code></li>
<li><code>increment_counter</code></li>
<li><code>toggle!</code></li>
<li><code>touch</code></li>
<li><code>update_all</code></li>
<li><code>update_attribute</code></li>
<li><code>update_column</code></li>
<li><code>update_columns</code></li>
<li><code>update_counters</code></li>
</ul>
<blockquote>
<p>另外，在需要验证的方法里如果传入<code>validates: false</code>也会跳过验证。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; save(validates: false)</div><div class="line">&gt;</div></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p>判断是否能通过验证：</p>
<ul>
<li><code>valid?</code></li>
</ul>
<blockquote>
<p><code>invalid?</code> 刚好相反，意思是要验证是否无法通过。</p>
</blockquote>
</li>
<li><p>关于获取验证的错误信息：</p>
<blockquote>
<p>所有发现的错误都可以通过实例方法<code>errors.messages</code>来获取。该方法会返回一个错误集合。</p>
</blockquote>
</li>
<li><p>如果想精确的查看某个属性存在错误，可以这样：</p>
<ul>
<li><code>.errors[attribute]</code></li>
</ul>
</li>
<li><p>进一步想看是什么导致的错误，可以这样：</p>
<ul>
<li><code>.errors.details[attribute]</code></li>
</ul>
</li>
<li><p>如果相关联的Model也要验证的话，可以这样：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">class Library &lt; ApplicationRecord</div><div class="line">  has_many :books</div><div class="line">  validates_associated :books</div><div class="line">end</div></pre></td></tr></table></figure>
</li>
<li><p>如果想验证一个重要的栏位，如果确认密码，邮件时，必须要两个 栏位都正确时，才会通过验证：</p>
<ul>
<li><p>创建一个虚拟属性，命名规则是在后面加<code>_confirmation</code> </p>
</li>
<li><p>在views中：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">%=</span> <span class="attr">text_field</span> <span class="attr">:person</span>, <span class="attr">:email</span> %&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">%=</span> <span class="attr">text_field</span> <span class="attr">:person</span>, <span class="attr">:email_confirmation</span> %&gt;</span></div></pre></td></tr></table></figure>
</li>
<li><p>在Model中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">class Person &lt; ApplicationRecord</div><div class="line">  validates :email, confirmation: true</div><div class="line">  validates :email_confirmation, presence: true</div><div class="line">end</div></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p>验证时，是否区分大小写：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; class Person &lt; ApplicationRecord</div><div class="line">&gt;   validates :email, confirmation: &#123; case_sensitive: false &#125;</div><div class="line">&gt; end</div><div class="line">&gt;</div></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p>辅助方法：验证是否在指定的集合中？</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">class Account &lt; ApplicationRecord</div><div class="line">  validates :subdomain, exclusion: &#123; in: %w(www us ca jp),</div><div class="line">    message: &quot;%&#123;value&#125; is reserved.&quot; &#125;</div><div class="line">end</div></pre></td></tr></table></figure>
<ol>
<li><p>format用正则表达式来匹配：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">class Product &lt; ApplicationRecord</div><div class="line">  validates :legacy_code, format: &#123; with: /\A[a-zA-Z]+\z/,</div><div class="line">    message: &quot;only allows letters&quot; &#125;</div><div class="line">end</div></pre></td></tr></table></figure>
</li>
<li><p>给验证限定指定的几个选项。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">class Coffee &lt; ApplicationRecord</div><div class="line">  validates :size, inclusion: &#123; in: %w(small medium large),</div><div class="line">    message: &quot;%&#123;value&#125; is not a valid size&quot; &#125;</div><div class="line">end</div></pre></td></tr></table></figure>
<blockquote>
<p>相反的结果：<code>within</code></p>
</blockquote>
</li>
<li><p>为栏位限定长度：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">class Coffee &lt; ApplicationRecord</div><div class="line">  validates :size, inclusion: &#123; in: %w(small medium large),</div><div class="line">    message: &quot;%&#123;value&#125; is not a valid size&quot; &#125;</div><div class="line">end</div></pre></td></tr></table></figure>
<p>可用的长度约束选项有：</p>
<ul>
<li><code>:minimum</code>：属性的值不能比指定的长度短；</li>
<li><code>:maximum</code>：属性的值不能比指定的长度长；</li>
<li><code>:in</code>（或 <code>:within</code>）：属性值的长度在指定的范围内。该选项的值必须是一个范围；</li>
<li><code>:is</code>：属性值的长度必须等于指定值；</li>
</ul>
</li>
<li><p>验证栏位必须是数字：</p>
<blockquote>
<p>默认情况下，匹配的值是可选的正负符号后加整数或浮点数。如果只接受整数，把 <code>:only_integer</code> 选项设为 <code>true</code>。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">class Player &lt; ApplicationRecord</div><div class="line">  validates :points, numericality: true</div><div class="line">  validates :games_played, numericality: &#123; only_integer: true &#125;</div><div class="line">end</div></pre></td></tr></table></figure>
<p>此外，还有以下这些选项：</p>
<ul>
<li><code>:greater_than</code>：属性值必须比指定的值大。该选项默认的错误消息是“must be greater than %{count}”；</li>
<li><code>:greater_than_or_equal_to</code>：属性值必须大于或等于指定的值。该选项默认的错误消息是“must be greater than or equal to %{count}”；</li>
<li><code>:equal_to</code>：属性值必须等于指定的值。该选项默认的错误消息是“must be equal to %{count}”；</li>
<li><code>:less_than</code>：属性值必须比指定的值小。该选项默认的错误消息是“must be less than %{count}”；</li>
<li><code>:less_than_or_equal_to</code>：属性值必须小于或等于指定的值。该选项默认的错误消息是“must be less than or equal to %{count}”；</li>
<li><code>:other_than</code>：属性值必须与指定的值不同。该选项默认的错误消息是“must be other than %{count}”。</li>
<li><code>:odd</code>：如果设为 <code>true</code>，属性值必须是奇数。该选项默认的错误消息是“must be odd”；</li>
<li><code>:even</code>：如果设为 <code>true</code>，属性值必须是偶数。该选项默认的错误消息是“must be even”；</li>
</ul>
<blockquote>
<p><code>numericality</code> 默认不接受 <code>nil</code> 值。可以使用 <code>allow_nil: true</code> 选项允许接受 <code>nil</code>。</p>
</blockquote>
</li>
<li><p>验证是否为空值：</p>
<ul>
<li><p><code>presence</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">class Person &lt; ApplicationRecord</div><div class="line">  validates :name, :login, :email, presence: true</div><div class="line">end</div></pre></td></tr></table></figure>
</li>
<li><p>验证关联的对象是否存在：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">class Order &lt; ApplicationRecord</div><div class="line">  has_many :line_items, inverse_of: :order</div><div class="line">end</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">class LineItem &lt; ApplicationRecord</div><div class="line">  belongs_to :order</div><div class="line">  validates :order, presence: true</div><div class="line">end</div></pre></td></tr></table></figure>
<blockquote>
<p>如果验证 <code>has_one</code> 或 <code>has_many</code> 关联的对象是否存在，会在关联的对象上调用 <code>blank?</code> 和 <code>marked_for_destruction?</code> 方法。</p>
<p>因为 <code>false.blank?</code> 的返回值是 <code>true</code>，所以如果要验证布尔值字段是否存在，要使用下述验证中的一个：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; validates :boolean_field_name, inclusion: &#123; in: [true, false] &#125;</div><div class="line">&gt; validates :boolean_field_name, exclusion: &#123; in: [nil] &#125;</div><div class="line">&gt;</div></pre></td></tr></table></figure>
</blockquote>
</li>
</ul>
</li>
<li><p>另外一个验证是否为空的方法：</p>
<ul>
<li><p><code>absence</code></p>
<blockquote>
<p>这个方法和上面的<code>presence</code> 比较相似，这里暂时跳过。</p>
</blockquote>
</li>
</ul>
</li>
<li><p>验证是否唯一性：</p>
<ul>
<li><p><code>uniqueness</code> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">class Account &lt; ApplicationRecord</div><div class="line">  validates :email, uniqueness: true</div><div class="line">end</div></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<ul>
<li><p>选项一   </p>
<p>可以加一个<code>:scope</code>以指定使用一个或多个属性</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt;   class Holiday &lt; ApplicationRecord</div><div class="line">&gt;     validates :name, uniqueness: &#123; scope: :year,</div><div class="line">&gt;       message: &quot;should happen once per year&quot; &#125;</div><div class="line">&gt;   end</div><div class="line">&gt;</div></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<p>&gt;</p>
<blockquote>
<p>  选项二   区分大小写用<code>case_sensitive</code></p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt;   class Person &lt; ApplicationRecord</div><div class="line">&gt;     validates :name, uniqueness: &#123; case_sensitive: false &#125;</div><div class="line">&gt;   end</div><div class="line">&gt;</div></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p>人才啊：这个方法可以用让其他类的方法来验证！也就是把借别人的方法来用！</p>
<ul>
<li><code>validates_with</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">class GoodnessValidator &lt; ActiveModel::Validator</div><div class="line">  def validate(record)</div><div class="line">    if record.first_name == &quot;Evil&quot;</div><div class="line">      record.errors[:base] &lt;&lt; &quot;This person is evil&quot;</div><div class="line">    end</div><div class="line">  end</div><div class="line">end</div><div class="line"> </div><div class="line">class Person &lt; ApplicationRecord</div><div class="line">  validates_with GoodnessValidator</div><div class="line">end</div></pre></td></tr></table></figure>
<blockquote>
<p><code>record.errors[:base]</code> 中的错误针对整个对象，而不是特定的属性。</p>
</blockquote>
</li>
<li><p>给要验证的对象使用代码块block来运算：</p>
<ul>
<li><p><code>validates_each</code></p>
<p>每次把对象传入block运算</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">class Person &lt; ApplicationRecord</div><div class="line">  validates_each :name, :surname do |record, attr, value|</div><div class="line">    record.errors.add(attr, &apos;must start with upper case&apos;) if value =~ /\A[[:lower:]]/</div><div class="line">  end</div><div class="line">end</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>一些常用的验证选项:</p>
<ul>
<li><code>allow_nil</code> ：如果要验证值为Nil就跳过验证。</li>
<li><code>allow_blank</code> ：和上面的类似。</li>
<li><code>message</code> ：当发生验证失败时，把message选项里的值赋给errors集合。</li>
<li><code>:on</code> ：指定什么时候验证。如<code>on: :create</code> <code>on: :update</code></li>
</ul>
</li>
<li><p>严格验证</p>
<ul>
<li><p><code>strict</code>  ：当对象无效时爆炸</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">class Person &lt; ApplicationRecord</div><div class="line">  validates :name, presence: &#123; strict: true &#125;</div><div class="line">end</div><div class="line"> </div><div class="line">Person.new.valid?  # =&gt; ActiveModel::StrictValidationFailed: Name can&apos;t be blank</div></pre></td></tr></table></figure>
<blockquote>
<p>同时还可以用<code>strict</code>来指定爆炸的提示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt; class Person &lt; ApplicationRecord</div><div class="line">&gt;   validates :token, presence: true, uniqueness: true, strict: TokenGenerationException</div><div class="line">&gt; end</div><div class="line">&gt;  </div><div class="line">&gt; Person.new.valid?  # =&gt; TokenGenerationException: Token can&apos;t be blank</div><div class="line">&gt;</div></pre></td></tr></table></figure>
</blockquote>
</li>
</ul>
</li>
<li><p>条件验证：只有当对象满足特定条件时，才触发验证，这个可以自己用<code>if</code> <code>unless</code>等条件语句实现。</p>
<ul>
<li><p>使用符号：<code>:if</code> 和 <code>:unless</code> 选项的值为符号时，表示要在验证之前执行对应的方法。这是最常用的设置方法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">class Order &lt; ApplicationRecord</div><div class="line">  validates :card_number, presence: true, if: :paid_with_card?</div><div class="line"> </div><div class="line">  def paid_with_card?</div><div class="line">    payment_type == &quot;card&quot;</div><div class="line">  end</div><div class="line">end</div></pre></td></tr></table></figure>
</li>
<li><p>条件组合：有时需要很多验证：</p>
<ul>
<li><code>with_options</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">class User &lt; ApplicationRecord</div><div class="line">  with_options if: :is_admin? do |admin|</div><div class="line">    admin.validates :password, length: &#123; minimum: 10 &#125;</div><div class="line">    admin.validates :email, presence: true</div><div class="line">  end</div><div class="line">end</div></pre></td></tr></table></figure>
</li>
<li><p>联合条件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">class Computer &lt; ApplicationRecord</div><div class="line">  validates :mouse, presence: true,</div><div class="line">                    if: [&quot;market.retail?&quot;, :desktop?],</div><div class="line">                    unless: Proc.new &#123; |c| c.trackpad.present? &#125;</div><div class="line">end</div></pre></td></tr></table></figure>
<p> 这里只有当<code>:if</code> 选项返回true,且<code>:unless</code>选项返回false时都会做验证。</p>
</li>
</ul>
</li>
<li><p>自定义验证</p>
<blockquote>
<p>跳过</p>
</blockquote>
</li>
<li><p>处理错误信息</p>
<ul>
<li><p>手动增加错误信息：</p>
<ul>
<li><p><code>errors.add</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">a.errors.add(:name, &quot;this is a example.&quot;)</div><div class="line">a.errors.full_messages </div><div class="line">#=&gt; [&quot;Title this is a example.&quot;]</div><div class="line">a.errors.to_a</div><div class="line">#=&gt; [&quot;Title this is a example.&quot;]</div></pre></td></tr></table></figure>
<blockquote>
<p>这个的<code>.to_a</code>和<code>.full_messages</code>是一样的效果。</p>
</blockquote>
</li>
<li><p><code>&lt;&lt;</code>方法，追回到errors.messages数组中。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">a.errors.messages[:name] &lt;&lt; &quot;test&quot;</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>不分属性栏位的错误提示：<code>errors[:base]</code> </p>
<blockquote>
<p>这里的错误信息是针对整个对象的。只是简单都标记这对象无效。</p>
</blockquote>
</li>
<li><p>清空错误信息：</p>
<ul>
<li><code>.clear</code></li>
</ul>
</li>
<li><p>查看错误错误信息的数量：</p>
<ul>
<li><code>.size</code></li>
</ul>
</li>
</ul>
</li>
</ol>
<h4 id="Active-Record回调"><a href="#Active-Record回调" class="headerlink" title="Active Record回调"></a>Active Record回调</h4><blockquote>
<p>什么是回调：回调使我们可以在对象状态更改之前或之后触发逻辑。</p>
</blockquote>
<p>通过回调，我们可以编写在创建、保存、更新、删除、验证或从数据库中加载 Active Record 对象时执行的代码。</p>
<blockquote>
<p>通常需要封装为私有方法。</p>
</blockquote>
<h5 id="方法列表："><a href="#方法列表：" class="headerlink" title="方法列表："></a>方法列表：</h5><ol>
<li>创建对象：<ul>
<li><code>before_validation</code></li>
<li><code>after_validation</code></li>
<li><code>before_save</code></li>
<li><code>around_save</code></li>
<li><code>before_create</code></li>
<li><code>around_create</code></li>
<li><code>after_create</code></li>
<li><code>after_save</code></li>
<li><code>after_commit/after_rollback</code></li>
</ul>
</li>
<li>更新对象：<ul>
<li><code>before_validation</code></li>
<li><code>after_validation</code></li>
<li><code>before_save</code></li>
<li><code>around_save</code></li>
<li><code>before_update</code></li>
<li><code>around_update</code></li>
<li><code>after_update</code></li>
<li><code>after_save</code></li>
<li><code>after_commit/after_rollback</code></li>
</ul>
</li>
<li>删除对象：<ul>
<li><code>before_destroy</code></li>
<li><code>around_destroy</code></li>
<li><code>after_destroy</code></li>
<li><code>after_commit/after_rollback</code></li>
</ul>
</li>
</ol>
<p>其他回调：</p>
<ol>
<li><p><code>after_initialize</code> <code>after_find</code> 在每次对数据库有操作时都会触发的回调。</p>
</li>
<li><p>下面这些方法会触发回调：</p>
<ul>
<li><code>create</code></li>
<li><code>create!</code></li>
<li><code>decrement!</code></li>
<li><code>destroy</code></li>
<li><code>destroy!</code></li>
<li><code>destroy_all</code></li>
<li><code>increment!</code></li>
<li><code>save</code></li>
<li><code>save!</code></li>
<li><code>save(validate: false)</code></li>
<li><code>toggle!</code></li>
<li><code>update_attribute</code></li>
<li><code>update</code></li>
<li><code>update!</code></li>
<li><code>valid?</code></li>
</ul>
<p>此外，下面这些查找方法会触发 <code>after_find</code> 回调：</p>
<ul>
<li><code>all</code></li>
<li><code>first</code></li>
<li><code>find</code></li>
<li><code>find_by</code></li>
<li><code>find_by_*</code></li>
<li><code>find_by_*!</code></li>
<li><code>find_by_sql</code></li>
<li><code>last</code></li>
</ul>
<p>每次初始化类的新对象时都会触发 <code>after_initialize</code> 回调。</p>
</li>
<li><p>一些会跳过回调的方法。</p>
<blockquote>
<p>在不清楚有什么回调的情况下，要慎重使用。</p>
</blockquote>
<ul>
<li><code>decrement</code></li>
<li><code>decrement_counter</code></li>
<li><code>delete</code></li>
<li><code>delete_all</code></li>
<li><code>increment</code></li>
<li><code>increment_counter</code></li>
<li><code>toggle</code></li>
<li><code>touch</code></li>
<li><code>update_column</code></li>
<li><code>update_columns</code></li>
<li><code>update_all</code></li>
<li><code>update_counters</code></li>
</ul>
</li>
<li><p>可以把回调的方法封装成一个类：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">class PictureFileCallbacks</div><div class="line">  def self.after_destroy(picture_file)</div><div class="line">    if File.exist?(picture_file.filepath)</div><div class="line">      File.delete(picture_file.filepath)</div><div class="line">    end</div><div class="line">  end</div><div class="line">end</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">class PictureFile &lt; ApplicationRecord</div><div class="line">  after_destroy PictureFileCallbacks</div><div class="line">end</div></pre></td></tr></table></figure>
</li>
<li><p>事务性回调：</p>
<ul>
<li><code>after_commit</code> <code>after_rollback</code> 这两个回调会在数据库事务完成时触发。</li>
<li>after_ commit包括在执行创建，更新，删除时会触发。所以，这些操作都拥有别名：<ul>
<li><code>after_create_commit</code></li>
<li><code>after_update_commit</code></li>
<li><code>after_update_commit</code></li>
</ul>
</li>
</ul>
<blockquote>
<p>在事务中使用回调要注意，如果其中一个发生异常，会使得其他回调不再执行。这点要注意。需要适当处理，以便让其他回调继续运行。</p>
</blockquote>
</li>
</ol>
<h4 id="Active-Record关联"><a href="#Active-Record关联" class="headerlink" title="Active Record关联"></a>Active Record关联</h4><ol>
<li><p>Rails支持六种关联：</p>
<ul>
<li><code>belongs_to</code></li>
<li><code>has_one</code></li>
<li><code>has_many</code></li>
<li><code>has_many :through</code></li>
<li><code>has_one :through</code></li>
<li><code>has_and_belongs_to_many</code></li>
</ul>
</li>
<li><h5 id="多态关联：超好用的模型关联，以后再也不用建立那么多图片数据表了！！！"><a href="#多态关联：超好用的模型关联，以后再也不用建立那么多图片数据表了！！！" class="headerlink" title="多态关联：超好用的模型关联，以后再也不用建立那么多图片数据表了！！！"></a>多态关联：超好用的模型关联，以后再也不用建立那么多图片数据表了！！！</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">class Picture &lt; ApplicationRecord</div><div class="line">  belongs_to :imageable, polymorphic: true</div><div class="line">end</div><div class="line"> </div><div class="line">class Employee &lt; ApplicationRecord</div><div class="line">  has_many :pictures, as: :imageable</div><div class="line">end</div><div class="line"> </div><div class="line">class Product &lt; ApplicationRecord</div><div class="line">  has_many :pictures, as: :imageable</div><div class="line">end</div></pre></td></tr></table></figure>
<p>在 <code>belongs_to</code> 中指定使用多态，可以理解成创建了一个接口，可供任何一个模型使用。在 <code>Employee</code> 模型实例上，可以使用 <code>@employee.pictures</code> 获取图片集合。</p>
<p>类似地，可使用 <code>@product.pictures</code> 获取产品的图片。</p>
<p>在 <code>Picture</code> 模型的实例上，可以使用 <code>@picture.imageable</code> 获取父对象。不过事先要在声明多态接口的模型中创建外键字段和类型字段：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">class CreatePictures &lt; ActiveRecord::Migration[5.0]</div><div class="line">  def change</div><div class="line">    create_table :pictures do |t|</div><div class="line">      t.string :name</div><div class="line">      t.references :imageable, polymorphic: true, index: true</div><div class="line">      t.timestamps</div><div class="line">    end</div><div class="line">  end</div><div class="line">end</div></pre></td></tr></table></figure>
<blockquote>
<p>现在才发现以前写那么多的图片的数据表，好浪费资源，浪费代码量。</p>
</blockquote>
</li>
<li><p>自联结</p>
<ul>
<li><p>有时，在同一表中需要息关联。如：同Users表中，有雇员，有经理，需要建立上级和下属的关系。怎么做：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">class Employee &lt; ApplicationRecord</div><div class="line">  has_many :subordinates, class_name: &quot;Employee&quot;,</div><div class="line">                          foreign_key: &quot;manager_id&quot;</div><div class="line"> </div><div class="line">  belongs_to :manager, class_name: &quot;Employee&quot;</div><div class="line">end</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">class CreateEmployees &lt; ActiveRecord::Migration[5.0]</div><div class="line">  def change</div><div class="line">    create_table :employees do |t|</div><div class="line">      t.references :manager, index: true</div><div class="line">      t.timestamps</div><div class="line">    end</div><div class="line">  end</div><div class="line">end</div></pre></td></tr></table></figure>
<p>这样定义模型后，可以使用 <code>@employee.subordinates</code> 和 <code>@employee.manager</code> 检索了。</p>
</li>
</ul>
</li>
<li><p>小技巧和注意事项</p>
<ul>
<li><p>控制缓存</p>
<p>关联添加的方法都会使用缓存，记录最近一次查询的结果，以备后用。缓存还会在方法之间共享。例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">author.books           # 从数据库中检索图书</div><div class="line">author.books.size      # 使用缓存的图书副本</div><div class="line">author.books.empty?    # 使用缓存的图书副本</div></pre></td></tr></table></figure>
<p>那，如何重新加载呢？<br><code>reload</code>方法即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">author.books.reload.empty?   # 丢掉缓存的图书副本</div></pre></td></tr></table></figure>
</li>
<li><p>避免命名冲突</p>
</li>
<li><p>控制关联的作用域：</p>
<blockquote>
<p>关联只会查找当前模块作用域中的对象。</p>
</blockquote>
<p>不同的命名空间中的模型要正常关联，就需要声明完整的类名：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">module MyApplication</div><div class="line">  module Business</div><div class="line">    class Supplier &lt; ApplicationRecord</div><div class="line">       has_one :account,</div><div class="line">        class_name: &quot;MyApplication::Billing::Account&quot;</div><div class="line">    end</div><div class="line">  end</div><div class="line"> </div><div class="line">  module Billing</div><div class="line">    class Account &lt; ApplicationRecord</div><div class="line">       belongs_to :supplier,</div><div class="line">        class_name: &quot;MyApplication::Business::Supplier&quot;</div><div class="line">    end</div><div class="line">  end</div><div class="line">end</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<hr>
<p>华丽丽的分割线，以下部分开始启动略过模式》》》》》》</p>
<blockquote>
<p>脑子里的代码记忆不够匹配，看这书真心烧脑，笔记记得再清楚，也记不住，还低效！如何破解：</p>
<ul>
<li>开启略过模式：只记录有什么工具，工具有什么作用。不过多记录用法，需要用到时再来复查。</li>
</ul>
</blockquote>
<hr>
<ol>
<li><p><code>:touch</code>选项的意思是：保存或销毁对象时，关联的对象的Update_at &amp;&amp; update_on 字段会自动设为当前时间。</p>
</li>
<li><p><code>validate</code> 选项，意思是，保存时，会同时验证关联的对象。</p>
</li>
<li><p><code>optional</code>选项，意思是，保存时，不会验证关联的对象是否存在。</p>
</li>
<li><p>如果经常透过第三方加载数据，如：@line_item.book.author,就可以在关联中及早把作者从商品引入图书中：这也是避免n+1query的作法。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">LineItem</span> &lt; ApplicationRecord</span></div><div class="line">  belongs_to <span class="symbol">:book</span>, -&gt; &#123; includes <span class="symbol">:author</span> &#125;</div><div class="line"><span class="keyword">end</span></div><div class="line"> </div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Book</span> &lt; ApplicationRecord</span></div><div class="line">  belongs_to <span class="symbol">:author</span></div><div class="line">  has_many <span class="symbol">:line_items</span></div><div class="line"><span class="keyword">end</span></div><div class="line"> </div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Author</span> &lt; ApplicationRecord</span></div><div class="line">  has_many <span class="symbol">:books</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p><code>dependent</code> 控制对象销毁后怎么处理关联的对象：</p>
<ul>
<li>destroy：也销毁关联的对象</li>
<li>delete：直接把关联的对象从数据库中删除。</li>
</ul>
</li>
<li><p>在<code>has_many</code>后面，自动会多出这些方法，比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">class Author &lt; ApplicationRecord</div><div class="line">  has_many :books</div><div class="line">end</div></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">books</div><div class="line">books&lt;&lt;(object, ...)</div><div class="line">books.delete(object, ...)</div><div class="line">books.destroy(object, ...)</div><div class="line">books=(objects)</div><div class="line">book_ids</div><div class="line">book_ids=(ids)</div><div class="line">books.clear</div><div class="line">books.empty?</div><div class="line">books.size</div><div class="line">books.find(...)</div><div class="line">books.where(...)</div><div class="line">books.exists?(...)</div><div class="line">books.build(attributes = &#123;&#125;, ...)</div><div class="line">books.create(attributes = &#123;&#125;)</div><div class="line">books.create!(attributes = &#123;&#125;)</div></pre></td></tr></table></figure>
<p>看吧，就会以有这么多方法可以用！</p>
<p>比如<code>@author.books &lt;&lt; @book1</code> 这个方法可以用来存储多个照片，很方便，可以直接就追加进去了！</p>
<ul>
<li><code>@author.books.clear</code> 这个方法可以把关联的对象清空</li>
<li><code>@author.books.empty?</code> 这个方法可以检查关联的对象是否为空？</li>
</ul>
</li>
<li><p><code>offset</code>方法</p>
<p>与limit差不多，但这里是跳过一定量的记录。如：</p>
<ul>
<li><code>-&gt; { offset(11) }</code>会跳过11个记录。</li>
</ul>
</li>
<li><p><code>readonly</code>方法，读取出来的对象是只读的。</p>
</li>
<li><p>关联扩展，可以使用其他类里面的方法，做法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">module FindRecentExtension</div><div class="line">  def find_recent</div><div class="line">    where(&quot;created_at &gt; ?&quot;, 5.days.ago)</div><div class="line">  end</div><div class="line">end</div><div class="line"> </div><div class="line">class Author &lt; ApplicationRecord</div><div class="line">  has_many :books, -&gt; &#123; extending FindRecentExtension &#125;</div><div class="line">end</div><div class="line"> </div><div class="line">class Supplier &lt; ApplicationRecord</div><div class="line">  has_many :deliveries, -&gt; &#123; extending FindRecentExtension &#125;</div><div class="line">end</div></pre></td></tr></table></figure>
</li>
<li><p>表单继承，把共同的东西都抽取出来，存入同一个模型。我又想到了众多图片可以存入同一个模型。</p>
<p>做法：假如有 Car、Motorcycle 和 Bicycle 三个模型，我们想在它们中共用 <code>color</code> 和 <code>price</code> 字段，但是各自的具体行为不同，而且使用不同的控制器。</p>
</li>
</ol>
<ul>
<li><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ rails generate model vehicle type:string color:string price:decimal&#123;10.2&#125;</div></pre></td></tr></table></figure>
</li>
<li><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ rails generate model car --parent=Vehicle</div></pre></td></tr></table></figure>
</li>
<li><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">class Car &lt; Vehicle</div><div class="line">end</div></pre></td></tr></table></figure>
<p>可以了，这样就节省了数据表了。</p>
</li>
</ul>
<h4 id="Active-Record-查询接口"><a href="#Active-Record-查询接口" class="headerlink" title="Active Record 查询接口"></a>Active Record 查询接口</h4><h5 id="检索单个对象："><a href="#检索单个对象：" class="headerlink" title="检索单个对象："></a>检索单个对象：</h5><ol>
<li><p><code>.find</code>方法 ：检索指定主键对应的对象</p>
<blockquote>
<p>会报错</p>
</blockquote>
<ul>
<li><code>Post.find(10)</code></li>
<li><code>Post.find([1,10])</code> 检查多个值。返回的结果也是数组形式</li>
</ul>
</li>
<li><p><code>.take</code>方法：检索一条记录而不考虑排序</p>
<blockquote>
<p>不会抛出异常</p>
</blockquote>
<ul>
<li><code>Post.take</code></li>
<li><code>Post.take(2)</code> 返回不超过指定数量的查询结果。</li>
</ul>
</li>
<li><p><code>.first</code>方法，返回第一条记录，如果没有找到不会抛出异常。</p>
<ul>
<li><p>可以指定数量：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Post.first(3)   返回头三个记录</div></pre></td></tr></table></figure>
</li>
<li><p>可以指定一个属性：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Post.order(:first_name).first</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><code>.last</code> 方法，基本和<code>first</code>一样，相反而已。</p>
</li>
<li><p><code>.find_by</code>还可以这样写:</p>
<ul>
<li><code>Post.find_by first_name:  &#39;activeliang&#39;</code></li>
</ul>
</li>
<li><p><code>find_each</code> ，分批量检索记录，每次都把记录传入block。</p>
<ul>
<li><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">User.find_each do |user|</div><div class="line">  NewsMailer.weekly(user).deliver_now</div><div class="line">end</div></pre></td></tr></table></figure>
</li>
<li><p><code>batch_size</code>规定一次检索的数量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">User.find_each(batch_size: 5000) do |user|</div><div class="line">  NewsMailer.weekly(user).deliver_now</div><div class="line">end</div></pre></td></tr></table></figure>
</li>
<li><p><code>start</code>规定要从哪一个记录开发检索，小于这个值的不会被检索。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">User.find_each(start: 2000) do |user|</div><div class="line">  NewsMailer.weekly(user).deliver_now</div><div class="line">end</div></pre></td></tr></table></figure>
</li>
<li><p><code>finish</code>规定到哪一个记录就停止，大于这个值的不会被检索。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">User.find_each(start: 2000, finish: 10000) do |user|</div><div class="line">  NewsMailer.weekly(user).deliver_now</div><div class="line">end</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><code>find_in_batches</code> 方法与前面的<code>find_each</code>类似，区别在于：这个方法是把批量的数据以数组的形式一次性传入block里的。</p>
</li>
</ol>
<h5 id="条件查询"><a href="#条件查询" class="headerlink" title="条件查询"></a>条件查询</h5><ol>
<li><p>查询时的子集条件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Post.where(orders_count: [1,3,5])</div></pre></td></tr></table></figure>
</li>
<li><p>not条件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Post.where.not(locked: true)</div></pre></td></tr></table></figure>
</li>
</ol>
<h5 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h5><ol>
<li><p>多个字段排序：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">Client.order(orders_count: :asc, created_at: :desc)</div><div class="line"># 或</div><div class="line">Client.order(:orders_count, created_at: :desc)</div><div class="line"># 或</div><div class="line">Client.order(&quot;orders_count ASC, created_at DESC&quot;)</div><div class="line"># 或</div><div class="line">Client.order(&quot;orders_count ASC&quot;, &quot;created_at DESC&quot;)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Client.order(&quot;orders_count ASC&quot;).order(&quot;created_at DESC&quot;)</div></pre></td></tr></table></figure>
<p>每次调用order的时候，都会在前一次的基础上进行排序。</p>
</li>
</ol>
<h5 id="选择选定的字段"><a href="#选择选定的字段" class="headerlink" title="选择选定的字段"></a>选择选定的字段</h5><ol>
<li><p>选择某个字段</p>
<ul>
<li><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Client.select(&quot;viewable_by, locked&quot;)</div></pre></td></tr></table></figure>
</li>
<li><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Client.select(:name).distinct    后面的选项表示无重复的。</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<h5 id="条件覆盖"><a href="#条件覆盖" class="headerlink" title="条件覆盖"></a>条件覆盖</h5><ol>
<li><p><code>unscope</code>方法，删除某些条件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Article.where(&apos;id &gt; 10&apos;).limit(20).order(&apos;id asc&apos;).unscope(:order)</div></pre></td></tr></table></figure>
</li>
<li><p><code>only</code>方法，忽略某些条件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Article.where(&apos;id &gt; 10&apos;).limit(20).order(&apos;id desc&apos;).only(:order, :where)</div></pre></td></tr></table></figure>
</li>
<li><p><code>reorder</code>方法，可以覆盖默认作用域中的排序方法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">class Article &lt; ApplicationRecord</div><div class="line">  has_many :comments, -&gt; &#123; order(&apos;posted_at DESC&apos;) &#125;</div><div class="line">end</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Article.find(10).comments.reorder(&apos;name&apos;)</div></pre></td></tr></table></figure>
</li>
<li><p><code>reverse_order</code>方法 ：反转排序结果。</p>
</li>
<li><p><code>rewhere</code>方法，覆盖where方法中指定的条件。</p>
</li>
</ol>
<h5 id="空关系"><a href="#空关系" class="headerlink" title="空关系"></a>空关系</h5><ol>
<li><p><code>none</code>方法，可以返回一个空Relation对象。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Article.none     #返回一个空的Relation对象，而且不执行查询</div></pre></td></tr></table></figure>
</li>
</ol>
<h5 id="在更新时锁定记录"><a href="#在更新时锁定记录" class="headerlink" title="在更新时锁定记录"></a>在更新时锁定记录</h5><ol>
<li><p>乐观锁定与悲观锁定。这里只讲理解，要用时再来深究。</p>
<blockquote>
<p>悲观锁：需要的悲观锁的数据，一旦有用户打开后，此数据就进入锁定状态，其他用户暂时无法再读取。当事务结束后，再释放这个锁定。</p>
<p>乐观锁：加了乐观锁的数据，同时会在数据库里需要珍上字段存储锁的版本，每次提交事务都会通过这个版本判断这个数据是否被改过，如果被改过则拒绝提交事务，但可以重来。</p>
</blockquote>
</li>
<li><p>n+1查询问题</p>
<blockquote>
<p>解决方法：通过指明<code>includes方法</code>，Active Record会使用尽可能少的查询来加载所有已指明的关联。</p>
<ul>
<li><p>多个关联的数组</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt;   Article.includes(:category, :comments)</div><div class="line">&gt;</div></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
</li>
<li><p>删除作用域：</p>
<blockquote>
<ul>
<li><code>unscoped</code> 方法</li>
</ul>
</blockquote>
</li>
<li><p><code>find_or_create_by</code> 意思是：检索，如果空的那就新建一个。</p>
</li>
<li><p>检查对象是否存在：</p>
<ul>
<li><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Post.exists?(1)</div><div class="line">POst.exists?(id: [1,2,3])</div></pre></td></tr></table></figure>
</li>
<li><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Post.any?</div><div class="line">Post.many?</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>数据库自带的计算功能：</p>
<ul>
<li><p><code>count</code>方法：计算计数</p>
</li>
<li><p><code>average</code>方法，计算平均值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Client.average(&quot;orders_count&quot;)</div></pre></td></tr></table></figure>
</li>
<li><p><code>minimum</code>方法，查找最小值</p>
</li>
<li><p><code>maximum</code>方法，查找最大值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Post.minimum(&quot;age&quot;)</div><div class="line">Post.maximum(&quot;age&quot;)</div></pre></td></tr></table></figure>
</li>
<li><p><code>sum</code>方法，求某个字段值的和。</p>
</li>
</ul>
</li>
</ol>
<h4 id="Active-Model-基础"><a href="#Active-Model-基础" class="headerlink" title="Active Model 基础"></a>Active Model 基础</h4><blockquote>
<p>这一章节讲的是有个叫Active Model的库，里面有很多模块。这里只是大概地说明了部分模块。</p>
</blockquote>
<ol>
<li><p>弄脏</p>
<p>如果修改了对象的一个或多个属性，但是没有保存，此时就把对象弄脏了。<code>ActiveModel::Dirty</code>模块提供检查对象是否被修改的功能。它还提供了基于属性的存取方法。假如有个 <code>Person</code> 类，它有两个属性，<code>first_name</code> 和 <code>last_name</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">class Person</div><div class="line">  include ActiveModel::Dirty</div><div class="line">  define_attribute_methods :first_name, :last_name</div><div class="line"> </div><div class="line">  def first_name</div><div class="line">    @first_name</div><div class="line">  end</div><div class="line"> </div><div class="line">  def first_name=(value)</div><div class="line">    first_name_will_change!</div><div class="line">    @first_name = value</div><div class="line">  end</div><div class="line"> </div><div class="line">  def last_name</div><div class="line">    @last_name</div><div class="line">  end</div><div class="line"> </div><div class="line">  def last_name=(value)</div><div class="line">    last_name_will_change!</div><div class="line">    @last_name = value</div><div class="line">  end</div><div class="line"> </div><div class="line">  def save</div><div class="line">    # 执行保存操作……</div><div class="line">    changes_applied</div><div class="line">  end</div><div class="line">end</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">person = Person.new</div><div class="line">person.changed? # =&gt; false</div><div class="line"> </div><div class="line">person.first_name = &quot;First Name&quot;</div><div class="line">person.first_name # =&gt; &quot;First Name&quot;</div><div class="line"> </div><div class="line"># 如果修改属性后未保存，返回 true</div><div class="line">person.changed? # =&gt; true</div><div class="line"> </div><div class="line"># 返回修改之后没有保存的属性列表</div><div class="line">person.changed # =&gt; [&quot;first_name&quot;]</div><div class="line"> </div><div class="line"># 返回一个属性散列，指明原来的值</div><div class="line">person.changed_attributes # =&gt; &#123;&quot;first_name&quot;=&gt;nil&#125;</div><div class="line"> </div><div class="line"># 返回一个散列，键为修改的属性名，值是一个数组，包含旧值和新值</div><div class="line">person.changes # =&gt; &#123;&quot;first_name&quot;=&gt;[nil, &quot;First Name&quot;]&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>这里就可以查询到某个参数是否被更改过？如果有，那原来提什么？</p>
</blockquote>
</li>
</ol>
<h4 id="Action-View-概览"><a href="#Action-View-概览" class="headerlink" title="Action View 概览"></a>Action View 概览</h4><ol>
<li><h5 id="DateHelper模块"><a href="#DateHelper模块" class="headerlink" title="DateHelper模块"></a>DateHelper模块</h5><ul>
<li><p><code>date_select</code>方法，选择年，月，日的选择列表。</p>
</li>
<li><p><code>datetime_select</code>方法，选择年，月，日，时，分的选择列表。</p>
</li>
<li><p><code>distance_of_time_in_words</code>方法，返回两个 时间的间隔：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">distance_of_time_in_words(Time.now, Time.now + 15.seconds)        # =&gt; less than a minute</div><div class="line">distance_of_time_in_words(Time.now, Time.now + 15.seconds, include_seconds: true)  # =&gt; less than 20 seconds</div></pre></td></tr></table></figure>
<blockquote>
<p>加入<code>include_seconds</code>选项设置为true可以得到更精确的时间间隔。</p>
</blockquote>
</li>
<li><p><code>select_date</code>方法，返回年月日的选择列表，并通过Datetime对象来设置默认值。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"># 生成一个日期时间选择列表，默认选中指定的日期时间（四天以后）</div><div class="line">select_datetime(Time.now + 4.days)</div><div class="line"> </div><div class="line"># 生成一个日期时间选择列表，默认选中今天（未指定日期时间）</div><div class="line">select_datetime()</div></pre></td></tr></table></figure>
</li>
<li><p><code>select_datetime</code> 方法，和上面的方法如出一辙。</p>
</li>
<li><p><code>select_day</code>方法，和上面的方法如出一辙。</p>
</li>
<li><p><code>select_hour</code>方法，和上面的方法如出一辙。</p>
</li>
<li><p><code>select_minute</code>方法。同上。</p>
</li>
<li><p><code>select_month</code>方法，同上。</p>
</li>
<li><p><code>select_second</code>方法，同上。</p>
</li>
<li><p><code>select_time</code></p>
</li>
<li><p><code>select_year</code></p>
</li>
<li><p><code>time_ago_in_words</code>方法，计算指定时间到当前时间的间隔。</p>
</li>
<li><p><code>time_select</code></p>
</li>
</ul>
</li>
<li><h4 id="FormHelper模块"><a href="#FormHelper模块" class="headerlink" title="FormHelper模块"></a>FormHelper模块</h4><ul>
<li><p><code>form_for</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"># 生成一个日期时间选择列表，默认选中指定的日期时间（四天以后）</div><div class="line">select_datetime(Time.now + 4.days)</div><div class="line"> </div><div class="line"># 生成一个日期时间选择列表，默认选中今天（未指定日期时间）</div><div class="line">select_datetime()</div></pre></td></tr></table></figure>
</li>
<li><p><code>check_box</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># 假设 @article.validated? 的值是 1</div><div class="line">check_box(&quot;article&quot;, &quot;validated&quot;)</div><div class="line"># =&gt; &lt;input type=&quot;checkbox&quot; id=&quot;article_validated&quot; name=&quot;article[validated]&quot; value=&quot;1&quot; /&gt;</div><div class="line">#    &lt;input name=&quot;article[validated]&quot; type=&quot;hidden&quot; value=&quot;0&quot; /&gt;</div></pre></td></tr></table></figure>
</li>
<li><p><code>label</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">label(:article, :title)</div><div class="line"># =&gt; &lt;label for=&quot;article_title&quot;&gt;Title&lt;/label&gt;</div></pre></td></tr></table></figure>
</li>
<li><p><code>radio_button</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"># 假设 @article.category 的值是“rails”</div><div class="line">radio_button(&quot;article&quot;, &quot;category&quot;, &quot;rails&quot;)</div><div class="line">radio_button(&quot;article&quot;, &quot;category&quot;, &quot;java&quot;)</div><div class="line"># =&gt; &lt;input type=&quot;radio&quot; id=&quot;article_category_rails&quot; name=&quot;article[category]&quot; value=&quot;rails&quot; checked=&quot;checked&quot; /&gt;</div><div class="line">#    &lt;input type=&quot;radio&quot; id=&quot;article_category_java&quot; name=&quot;article[category]&quot; value=&quot;java&quot; /&gt;</div></pre></td></tr></table></figure>
</li>
<li><p><code>email_field</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">email_field(:user, :email)</div><div class="line"># =&gt; &lt;input type=&quot;email&quot; id=&quot;user_email&quot; name=&quot;user[email]&quot; value=&quot;#&#123;@user.email&#125;&quot; /&gt;</div></pre></td></tr></table></figure>
</li>
<li><p><code>url_field</code></p>
<blockquote>
<p>看到这个方法的我，眼泪掉下来</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">url_field(:user, :url)</div><div class="line"># =&gt; &lt;input type=&quot;url&quot; id=&quot;user_url&quot; name=&quot;user[url]&quot; value=&quot;#&#123;@user.url&#125;&quot; /&gt;</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><h4 id="FormOptionsHelper模块"><a href="#FormOptionsHelper模块" class="headerlink" title="FormOptionsHelper模块"></a>FormOptionsHelper模块</h4><ul>
<li><code>image_submit_tag</code> ：此方法会显示一张图像，点击图像会提交表单。</li>
</ul>
</li>
<li><h4 id="JavaScriptHelper模块"><a href="#JavaScriptHelper模块" class="headerlink" title="JavaScriptHelper模块"></a>JavaScriptHelper模块</h4><ul>
<li><p><code>javascript_tag</code>方法，可以很方便在页面中塞Javascripts语句</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">javascript_tag <span class="string">"alert('All is good')"</span></div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><h4 id="NumberHelper模块"><a href="#NumberHelper模块" class="headerlink" title="NumberHelper模块"></a>NumberHelper模块</h4><ul>
<li><p><code>number_to_currency</code> 方法，把数字转换成货币字符串：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">number_to_currency(1234567890.50) # =&gt; $1,234,567,890.50</div><div class="line"></div><div class="line">6.12.2</div></pre></td></tr></table></figure>
</li>
<li><p><code>number_with_delimiter</code>方法，把数字软的成带千们转换符的数字。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">number_with_delimiter(12345678) # =&gt; 12,345,678</div></pre></td></tr></table></figure>
</li>
<li><p><code>number_with_precision</code>方法，把数字转换成具有指定精度的数字。</p>
</li>
</ul>
</li>
</ol>
<h4 id="Rails-布局和视图渲染"><a href="#Rails-布局和视图渲染" class="headerlink" title="Rails 布局和视图渲染"></a>Rails 布局和视图渲染</h4><ol>
<li><p><code>render</code>方法：</p>
<ul>
<li><p><code>:plain</code>选项，可以直接返回没有标记语言的线文本：<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure></p>
<p>render plain: “OK”</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">- `:html`选项，可以直接返回页面使用的html：</div></pre></td></tr></table></figure>
<p>render html : “<strong>Not Found</strong>“.html_safe</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">- `:inline`选项，直接返回erb代码。</div></pre></td></tr></table></figure>
<p>render inline: “&lt;% products.each do |p| %&gt;</p><p>&lt;%= p.name %&gt;</p>&lt;% end %&gt;”<p></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">- `json` `xml`</div><div class="line"></div><div class="line">- `js`</div></pre></td></tr></table></figure>
<p>render js: “alert(‘Hello Rails’);”</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">   - `:status` 直接返回状态码</div><div class="line"></div><div class="line">   - `formats` 返回数据格式</div><div class="line"></div><div class="line">   &gt; `render` 和 `redirect_to`的区别：`render`会直接去加载html页面而不会通过controller,而`redirect_to` 会重新从controller开发请求。</div><div class="line"></div><div class="line">2. `redirect_to`方法</div><div class="line"></div><div class="line">3. `javascript_include_tag`可以很方便引入js</div></pre></td></tr></table></figure>
</li>
</ul>
<p>&lt;%= javascript_include_tag “main”, “/photos/columns” %&gt;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure>
<p>&lt;%= javascript_include_tag “<a href="http://example.com/main.js" target="_blank" rel="external">http://example.com/main.js</a>“ %&gt;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">4. `stylesheet_link_tag`可以很方便引入css，大致方法同上。</div><div class="line"></div><div class="line">5. `video_tag` 方法可以很方便载入视频。</div></pre></td></tr></table></figure>
<p>&lt;%= video_tag “movie.ogg” %&gt;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">   `video_tag` 方法还可使用散列指定 `&lt;video&gt;` 标签的所有属性，包括：</div><div class="line"></div><div class="line">   - `poster: &quot;image_name.png&quot;`：指定视频播放前在视频的位置显示的图片；</div><div class="line">   - `autoplay: true`：页面加载后开始播放视频；</div><div class="line">   - `loop: true`：视频播完后再次播放；</div><div class="line">   - `controls: true`：为用户显示浏览器提供的控件，用于和视频交互；</div><div class="line">   - `autobuffer: true`：页面加载时预先加载视频文件；</div><div class="line"></div><div class="line">6. `audio_tag`方法，可以很方便载入音频。</div><div class="line"></div><div class="line">   与 `video_tag` 类似，`audio_tag` 也有特殊的选项：</div><div class="line"></div><div class="line">   - `autoplay: true`：页面加载后开始播放音频；</div><div class="line">   - `controls: true`：为用户显示浏览器提供的控件，用于和音频交互；</div><div class="line">   - `autobuffer: true`：页面加载时预先加载音频文件；</div><div class="line"></div><div class="line">#### 表单辅助方法</div><div class="line"></div><div class="line">1. 一些辅助方法：</div></pre></td></tr></table></figure>
<p>&lt;%= text_area_tag(:message, “Hi, nice site”, size: “24x6”) %&gt;<br>&lt;%= password_field_tag(:password) %&gt;<br>&lt;%= hidden_field_tag(:parent_id, “5”) %&gt;<br>&lt;%= search_field(:user, :name) %&gt;<br>&lt;%= telephone_field(:user, :phone) %&gt;<br>&lt;%= date_field(:user, :born_on) %&gt;<br>&lt;%= datetime_local_field(:user, :graduation_day) %&gt;<br>&lt;%= month_field(:user, :birthday_month) %&gt;<br>&lt;%= week_field(:user, :birthday_week) %&gt;<br>&lt;%= url_field(:user, :homepage) %&gt;<br>&lt;%= email_field(:user, :address) %&gt;<br>&lt;%= color_field(:user, :favorite_color) %&gt;<br>&lt;%= time_field(:task, :started_at) %&gt;<br>&lt;%= number_field(:product, :price, in: 1.0..20.0, step: 0.5) %&gt;<br>&lt;%= range_field(:product, :discount, in: 1..100) %&gt;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">2. 终于知道如何在一个表单内完成同时创建两个值的方法了！：</div><div class="line"></div><div class="line">   - `fields_for`方法可以办到：</div></pre></td></tr></table></figure>
<p>  &lt;%= form_for @person, url: {action: “create”} do |person_form| %&gt;</p>
<pre><code>&lt;%= person_form.text_field :name %&gt;
&lt;%= fields_for @person.contact_detail do |contact_detail_form| %&gt;
  &lt;%= contact_detail_form.text_field :phone_number %&gt;
&lt;% end %&gt;
</code></pre><p>  &lt;% end %&gt;</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">3. Form_for处理命名空间：</div><div class="line">   ![](http://olmrxx9ks.bkt.clouddn.com/2017-07-30-Snip20170730_1.png)</div><div class="line"></div><div class="line">   1. 快速动态生成选择列表</div><div class="line"></div><div class="line">      - `select_tag`</div></pre></td></tr></table></figure>
<pre><code>&lt;%= select_tag(:city_id, &apos;&lt;option value=&quot;1&quot;&gt;Lisbon&lt;/option&gt;...&apos;) %&gt;
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">- `options_for_select`</div></pre></td></tr></table></figure>

&lt;%= options_for_select([[&apos;Lisbon&apos;, 1], [&apos;Madrid&apos;, 2], ...]) %&gt;
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">两者相结合，就可以动态方便都生成了：</div></pre></td></tr></table></figure>
</code></pre><p>   &lt;%= select_tag(:city_id, options_for_select(…)) %&gt;</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">   - 到这里，还有一个问题没有解决：option的选项还是需要手工，如果选项很多，那得输死。解决方法：见下面</div><div class="line"></div><div class="line">4. 从任意对象组成的集合中创建option标签。</div><div class="line"></div><div class="line">   - 先把选项变成一个集合，再整合进`option_for_select`</div></pre></td></tr></table></figure>
<p>  &lt;% cities_array = City.all.map { |city| [city.name, city.id] } %&gt;<br>  &lt;%= options_for_select(cities_array) %&gt;</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">- 更简单粗暴的作法：</div><div class="line"></div><div class="line">  利用rails已经帮我们内建的方法：`options_from_collection_for_select`</div></pre></td></tr></table></figure>
<p>  &lt;%= options_from_collection_for_select(City.all, :id, :name) %&gt;</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">5. 时间日期的表单辅助方法</div><div class="line"></div><div class="line">   -</div></pre></td></tr></table></figure>
<p>  &lt;%= select_date Date.today, prefix: :start_date %&gt;</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">- 处理模型对象时，可以更简单粗暴：</div></pre></td></tr></table></figure>
<p>  &lt;%= date_select :person, :birth_date %&gt;</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">   &gt; 通常rails的内置方法只是会包括前后5年而已，如果想更多，可以设置`start_year` `end_year` </div><div class="line"></div><div class="line">6. ##### 上传文件</div><div class="line"></div><div class="line">   &gt; 在上传文件时特别需要注意的是，表单的编码必须设置为 `multipart/form-data`。使用 `form_for` 辅助方法时会自动完成这一设置。如果使用 `form_tag` 辅助方法，就必须手动完成这一设置，具体操作可以参考下面的例子。</div><div class="line">   &gt;</div><div class="line">   &gt;</div></pre></td></tr></table></figure>
<blockquote>
<p>&lt;%= form_tag({action: :upload}, multipart: true) do %&gt;<br>  &lt;%= file_field_tag ‘picture’ %&gt;<br>&lt;% end %&gt;</p>
<p>&lt;%= form_for @person do |f| %&gt;<br>  &lt;%= f.file_field :picture %&gt;<br>&lt;% end %&gt;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">#### Action Controller概览</div><div class="line"></div><div class="line">&gt; 控制器负责解析请求，生成相应的输出。</div><div class="line"></div><div class="line">1. rails的参数要求是标量值，数组和Hash不是标量值，所以不能被使用。</div><div class="line"></div><div class="line">   &gt; 允许使用的标量类型：有：`String`、`Symbol`、`NilClass`、`Numeric`、`TrueClass`、`FalseClass`、`Date`、`Time`、`DateTime`、`StringIO`、`IO`、`ActionDispatch::Http::UploadedFile` 和 `Rack::Test::UploadedFile`</div><div class="line"></div><div class="line">2. 会话（原来就是session)</div><div class="line"></div><div class="line">3. ##### 事务transaction</div><div class="line"></div><div class="line">   &gt; 主要的作用是，把一系列的数据库操作包裹在一起，当其中一条出错时，整个操作会回滚！</div><div class="line"></div><div class="line">   常见的错误用法：</div><div class="line"></div><div class="line">   1. 单条记录操作时使用事务</div><div class="line">   2. 不必要的使用嵌套式事务</div><div class="line">   3. 事务中的代码不会导致回滚</div><div class="line">   4. 在 controller 中使用事务</div><div class="line"></div><div class="line">   其中第3条占比比较多，常见：</div><div class="line"></div><div class="line">   - 没有使用`!`方法，遇错不回滚</div><div class="line">   - 容易出错的地方，主动判断，主动抛出异常</div><div class="line">   - 嵌套的事务中，子事务的遇错回滚不会上传到父事务。</div><div class="line"></div><div class="line">4. 数据流和文件下载</div><div class="line"></div><div class="line">   &gt; 这里提供了两个方法，可以直接传送数据给用户。像我们平时下载文件一样！</div><div class="line">   &gt;</div><div class="line">   &gt; - `send_data` 主要是把数据以流的形式发送。</div><div class="line">   &gt; - `send_file` 主要是用来发送磁盘中现有的数据。</div><div class="line"></div><div class="line">   &gt; 另外本书提示：下载最好是放在public里，这样能直接代下载，不需要经常rails栈，效率更高。</div><div class="line"></div><div class="line">5. REST式下载</div><div class="line"></div><div class="line">   优势：不使用数据流：</div></pre></td></tr></table></figure>
</blockquote>
<p>class ClientsController &lt; ApplicationController</p>
<h1 id="用户可以请求接收-HTML-或-PDF-格式的资源"><a href="#用户可以请求接收-HTML-或-PDF-格式的资源" class="headerlink" title="用户可以请求接收 HTML 或 PDF 格式的资源"></a>用户可以请求接收 HTML 或 PDF 格式的资源</h1><p>  def show</p>
<pre><code>@client = Client.find(params[:id])

respond_to do |format|
  format.html
  format.pdf { render pdf: generate_pdf(@client) }
end
</code></pre><p>  end<br>end</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">为了让这段代码能顺利运行，要把 PDF 的 MIME 类型加入 Rails。在 `config/initializers/mime_types.rb` 文件中加入下面这行代码即可:</div></pre></td></tr></table></figure>
<p>Mime::Type.register “application/pdf”, :pdf</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">6. 强大的数据流：</div><div class="line"></div><div class="line">   &gt; 这个就好像和浏览器一直在通话一样，你可以随时发送数据。（平常的请求可以理解为微信发语音，而数据流可以想象成语音通话）</div><div class="line"></div><div class="line">7. 强制使用HTTPS协议</div><div class="line"></div><div class="line">   - 在controller里增加：</div></pre></td></tr></table></figure>
<p>  class DinnerController</p>
<pre><code>force_ssl only: :cheeseburger
# 或者
force_ssl except: :cheeseburger
</code></pre><p>  end</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">#### Rails 路由全解</div><div class="line"></div><div class="line">1. 同时定义多个资源：</div></pre></td></tr></table></figure>
<p>resources :photos, :books, :videos</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">   &gt; FUCK，原来可以这样！</div><div class="line"></div><div class="line">2. 使用单数资源时，form_for辅助方法无法自动处理单数资源，这里我们需要指定表单URL，例如：</div></pre></td></tr></table></figure>
<p>form_for @geocoder, url: geocoder_path do |f|</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">3. 嵌套资源最好不要超过1层</div><div class="line"></div><div class="line">4. 有时可以省略`path` ：</div></pre></td></tr></table></figure>
<p>&lt;%= link_to ‘Ad details’, magazine_ad_path(@magazine, @ad) %&gt;<br>&lt;%= link_to ‘Ad details’, [@magazine, @ad] %&gt;<br>&lt;%= link_to ‘Magazine details’, @magazine %&gt;<br>&lt;%= link_to ‘Edit Ad’, [:edit, @magazine, @ad] %&gt;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">5. 动态片段</div></pre></td></tr></table></figure>
<p>get ‘photos/:id/:user_id’, to: ‘photos#show’<br>```</p>
<p><code>/photos/1/2</code> 路径会被映射到 <code>Photos</code> 控制器的 <code>show</code> 动作上。此时，<code>params[:id]</code> 的值是 <code>&quot;1&quot;</code>，<code>params[:user_id]</code> 的值是 <code>&quot;2&quot;</code>。</p>
<ul>
<li>片段限制</li>
<li>请求限制</li>
<li>通配符和通配片段</li>
</ul>
</li>
</ol>
<h5 id="前半部分结束》》》》》》》》》》》》》》"><a href="#前半部分结束》》》》》》》》》》》》》》" class="headerlink" title="前半部分结束》》》》》》》》》》》》》》"></a>前半部分结束》》》》》》》》》》》》》》</h5><hr>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/archives/2017/08/03/2017-08-03-part-iii-of-the-ruby-base-tutorial-extraction/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="黄鸿亮">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://olmrxx9ks.bkt.clouddn.com/2017-09-07-080115.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Activeliang's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/archives/2017/08/03/2017-08-03-part-iii-of-the-ruby-base-tutorial-extraction/" itemprop="url">《ruby基础教程》 第三部分 提取</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-03T01:28:00+08:00">
                2017-08-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="第三部分"><a href="#第三部分" class="headerlink" title="第三部分"></a>第三部分</h3><h4 id="数值类"><a href="#数值类" class="headerlink" title="数值类"></a>数值类</h4><ol>
<li><p>一些方法：</p>
<ul>
<li><p>返回商的整数：<code>x.quo(y)</code></p>
</li>
<li><p>返回一个数组，[商，余数]：<code>x.divmod(y)</code></p>
</li>
<li><p><code>Math模块</code> 你想得到的数学函数都在里面</p>
</li>
<li><p>返回整数部分：<code>.floor</code></p>
</li>
<li><p>返回100以内的随机数：<code>Random.rand(100)</code> （比我以前学的VB方便太多了好嘛！）</p>
</li>
<li><p><code>Integer</code>的迭代方法：</p>
<ul>
<li><code>upto</code>遍历</li>
<li><code>downto</code>遍历</li>
</ul>
</li>
<li><p>以分数的形式存在：<code>Rational(1, 10)</code></p>
</li>
<li><p>按<code>step</code>迭代的方法：</p>
<ul>
<li><p>2到10，每次加3：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">2.step(10,3) do |i|</div><div class="line">  p i</div><div class="line">end                      #=&gt; 2, 5, 8</div></pre></td></tr></table></figure>
</li>
<li><p>10到2，每次减3：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">10.step(2,-3) do |i|</div><div class="line">  p i </div><div class="line">end                      #=&gt; 10, 7, 4</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
</ol>
<h4 id="数组："><a href="#数组：" class="headerlink" title="数组："></a>数组：</h4><ol>
<li><p><code>Array.new方法</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Array.new          #=&gt; []</div><div class="line">Array.new(5)       #=&gt; [nil,nil,nil,nil,nil]</div><div class="line">Array.new(5,0)     #=&gt; [0,0,0,0,0]</div></pre></td></tr></table></figure>
</li>
<li><p><code>%w</code>和<code>%i</code></p>
<ul>
<li><p>创建不包含空白的字符串数组时，可以使用<code>%w</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">lang = %w(Ruyb Perl Python Scheme Pike)</div><div class="line">p lang    #=&gt;[&quot;Ruby&quot;,&quot;Perl&quot;,&quot;Python&quot;,&quot;Scheme&quot;,&quot;Pike&quot;]</div></pre></td></tr></table></figure>
</li>
<li><p>创建不包含空白的符号数组时，可以使用<code>%i</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">lang = %w(Ruyb Perl Python Scheme Pike)</div><div class="line">p lang    #=&gt;[:Ruby,:Perl,:Python,:Scheme,:Pike]</div></pre></td></tr></table></figure>
</li>
</ul>
<p>其中<code>()</code>可替换成其他符号：<code>&lt;&gt;</code> <code>||</code> <code>!!</code> <code>@@</code> <code>AA</code></p>
</li>
<li><p>将散列转换成数组：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">a = &#123;a: 1, b: 2&#125;</div><div class="line">a.to_a              #=&gt;  [[:a, 1], [:b, 2]]</div></pre></td></tr></table></figure>
</li>
<li><p>一次性拿到多个值：</p>
<ul>
<li><code>a[n]</code> or <code>a[-n]</code> 如果是负数，就倒着开始取值。超过总数值会报错。</li>
</ul>
</li>
</ol>
<ul>
<li><code>a[n..m]</code> or <code>a[n…m]</code><ul>
<li><code>a[n,len]</code> 从某个元素起，取n个字符。</li>
</ul>
</li>
</ul>
<ol>
<li><p>一次性赋多个值：</p>
<ul>
<li><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">a = [1,2,3,4,5,6]</div><div class="line">a[2,3] = [c,d,e]     #=&gt; [1,2,c,d,e,6]</div><div class="line">a[2,0] = [a,b]       #=&gt; [1,2,a,b,3,4,5,6]</div></pre></td></tr></table></figure>
</li>
<li><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">a = [1,2,3,4,5,6]</div><div class="line">a[2..3] = [a,b]      #=&gt; [1,2,a,b,5,6]</div></pre></td></tr></table></figure>
</li>
<li><p><code>.values_at方法</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">a = [1,2,3,4,5,6]</div><div class="line">a.values_at(1,3,5)     #=&gt; [2,4,6]</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>把数组当集合来运算：</p>
<ul>
<li><p>交集：<code>ary = ary1 &amp; ary2</code></p>
</li>
<li><p>并集：<code>ary = ary1 | ary2</code></p>
</li>
<li><p>集合的差：<code>ary = ary1 - ary2</code> （在1中找2没有的元素）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ary1 = [&quot;a&quot;,&quot;b&quot;,&quot;c&quot;]</div><div class="line">ary2 = [&quot;b&quot;,&quot;c&quot;,&quot;d&quot;]</div><div class="line">p (ary1 - ary2)        #=&gt; [&quot;a&quot;]</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>把数组当<u><strong>列</strong></u>：</p>
<blockquote>
<p>数组结构：</p>
<ul>
<li>队列：以排列的顺序，先进先出。（像排队过关一样）</li>
<li>栈：以相反的顺序，先进后出。（像堆东西一样，最慢放入的最容易取出）</li>
</ul>
</blockquote>
<ul>
<li>追加，删除，引用：</li>
</ul>
<p>|  操作  |  在头部开刀  | 在尾部开刀 |<br>| :–: | :—–: | :—: |<br>| 追加元素 | unshift | push  |<br>| 删除元素 |  shift  |  pop  |<br>| 引用元素 |  first  | last  |</p>
<p>例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">a = [1,2,3,4,5]</div><div class="line">a.push(&quot;E&quot;)       #=&gt; [1,2,3,4,5,E]</div><div class="line">a.shift           #=&gt; 1       </div><div class="line">a                 #=&gt; [2,3,4,5,E]</div></pre></td></tr></table></figure>
</li>
</ol>
<h5 id="一些操作方法："><a href="#一些操作方法：" class="headerlink" title="一些操作方法："></a>一些操作方法：</h5><ol>
<li><p>为数组增加元素：</p>
<ul>
<li><p><code>a.unshift(item)</code></p>
</li>
<li><p><code>a.push(item)      ~=       a &lt;&lt; item</code></p>
</li>
<li><p><code>a.concat(b)</code> &amp; <code>a+b</code></p>
<blockquote>
<p>这个<code>concat方法是破坏性方法</code>，会改变被引用的对象。</p>
</blockquote>
</li>
</ul>
<blockquote>
<p>什么是<strong><u>破坏性的方法</u></strong>？</p>
<p>：会改变接收对象值的方法！要注意：被引用的对象也会被破坏！如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt; a = [1,2,3,4]</div><div class="line">&gt; b = a</div><div class="line">&gt; b.pop     #=&gt; 4</div><div class="line">&gt; p a       #=&gt; [1,2,3]</div><div class="line">&gt;</div></pre></td></tr></table></figure>
</blockquote>
<p>&gt;</p>
<blockquote>
<p>提示：这里b引用了a，并不是复制一个a，而是让a和b同时引用一个对象！这一点要纠正认识！</p>
</blockquote>
</li>
<li><p>从数组中删除元素：</p>
<ul>
<li><code>a.compact</code> &amp; <code>a.compact!</code>    ：会把a数组中的空元素nil去掉！区别：<ul>
<li>第一种会返回一个新的数组。</li>
<li>第二种会直接替换掉原来的数组。</li>
</ul>
</li>
<li><code>a.delete(x)</code>  ：从数组中删除x元素。</li>
<li><code>a.delete_at(n)</code>  : 从数组中删除a[n]元素。</li>
<li><code>a.delete_if {|item| … }</code><br><code>a.reject {|item| … }</code><br><code>a.reject! {|item| … }</code><br>: 这三个方法表示：遍历所有元素，如何右边的block块成立就删掉，其中带感叹号表示破坏性的方法！</li>
<li><code>a.slice!(n)</code><br><code>a.slice!(n..m)</code><br><code>a.slice!K(n,len)</code><br>: 这三个方法表示：从数组a中删除指定的部分，并返回被删除的部分的值。slice!是具有破坏性的方法。</li>
<li><code>a.uniq</code> &amp; <code>a.uniq!</code> ：表示：去掉重复的元素。</li>
<li><code>a.shift</code>  ：删除开头的元素。返回删除的值。</li>
<li><code>a.pop</code>   ：删除末尾的元素。返回删除的值。</li>
</ul>
</li>
<li><p>替换数组元素：</p>
<ul>
<li><p><code>a.collect{|item| … }</code><br><code>a.collect!{|item| … }</code><br><code>a.map{|item| … }</code><br><code>a.map!{|item| … }</code><br>: 遍历数组a和各元素传给block中的item,最后付出处理后的结果。</p>
</li>
<li><p><code>a.fill(value)</code><br><code>a.fill(value, begin)</code><br><code>a.fill(value, begin, len)</code><br><code>a.fill(value, n..m)</code><br>： 把数组指定元素全部替换成value，默认为全部。</p>
</li>
<li><p><code>a.flatten</code> &amp; <code>a.flatten!</code> ：平坦化数组a，就是把里面嵌套的数组展开成一个大数组。(soga，原来是这样啊！)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">a = [1,[2,[3]],[4],5]</div><div class="line">a.flatten!</div><div class="line">p a      #=&gt; [1,2,3,4,5]</div></pre></td></tr></table></figure>
</li>
<li><p><code>a.reverse</code> &amp; <code>a.reverse!</code> :反转数组a的元素顺序。</p>
</li>
<li><p><code>a.sort</code><br><code>a.sort!</code><br><code>a.sort {|i,j| … }</code><br><code>a.sort {|i,j| … }</code><br>：排序，其中block中的<code>i</code> &amp; <code>j</code> 表示：从数组中两个两个拿出来的数据。</p>
</li>
<li><p><code>a.sort_by{|i| … }</code> ：根据块的运行结果时序排序。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">a = [2,4,3,5,1]</div><div class="line">p a.sort_by&#123;|i| -i &#125;     #=&gt; [5,4,3,2,1]  (这里的block只是参与计算而已，不会破坏原来的数组。)</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>数组与迭代器：有些使用迭代器的对象不是数组，但处理后会返回一个数组:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">a = 1..5</div><div class="line">b = a.collect&#123;|i| i += 2&#125;</div><div class="line">p b          #=&gt; [3,4,5,6,7]</div></pre></td></tr></table></figure>
</li>
<li><p>数组的初始化问题：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">a = Array.new(3, [0,0,0])    #=&gt; [[0,0,0],[0,0,0],[0,0,0]]</div><div class="line">a[0][1] = 2                  #=&gt; [[0,2,0],[0,2,0],[0,2,0]]</div><div class="line">数组的初始化就是有这些问题，要注意，可以使用block带解决：</div><div class="line">a = Array.new(3) &#123;[0,0,0])&#125;    #=&gt; [[0,0,0],[0,0,0],[0,0,0]]</div><div class="line">a[0][1] = 2                    #=&gt; [[0,2,0],[0,0,0],[0,0,0]]</div></pre></td></tr></table></figure>
</li>
<li><p><code>zip方法</code> ：引进多个数组，然后同步遍历！：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">ary1 = [1,2,3,4,5]</div><div class="line">ary2 = [10,20,30,40,50]</div><div class="line">ary3 = [100,200,300,400,500]</div><div class="line"></div><div class="line">result = []</div><div class="line">ary1.zip(ary2,ary3) do |a, b, c|</div><div class="line">  result &lt;&lt; a + b + c</div><div class="line">end</div><div class="line">p  result     #=&gt; [111, 222, 333, 444, 555]</div></pre></td></tr></table></figure>
</li>
<li><p>一个过滤数组的方法：<code>.select</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">a = (1..100).to_a</div><div class="line">a.select&#123;|i| i % 3 == 0&#125;    过滤3的倍数。</div></pre></td></tr></table></figure>
<p>​</p>
</li>
</ol>
<h5 id="13章练习题："><a href="#13章练习题：" class="headerlink" title="13章练习题："></a>13章练习题：</h5><ol>
<li><p>创建一个1到100的整数按升序排列的数组：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(1..100).to_a</div></pre></td></tr></table></figure>
</li>
<li><p>累加1中的数组：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">a.reduce :+</div></pre></td></tr></table></figure>
</li>
<li><p><code>inject方法</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">a.inject(0)&#123;|memo, i| memo += i&#125;</div><div class="line">表示：遍历数组元素赋值给i，每次结果回传给memo.实现累加的效果。</div></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="字符串String"><a href="#字符串String" class="headerlink" title="字符串String"></a>字符串String</h4><ol>
<li><p>什么是内嵌表达式？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&quot;String#&#123;ruby&#125;&quot;      #=&gt; 这个#&#123;&#125;里可以执行ruby表达式的东西就是啦！</div></pre></td></tr></table></figure>
</li>
<li><p>创建字符串</p>
<ul>
<li><p>使用%Q与%q</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">desc = %Q&#123;Ruby 的字符中也可以使用&apos;&apos; 和 &quot;&quot;.&#125;</div><div class="line">str = %q|Ruby said, &apos;Hello world!&apos;|</div><div class="line"></div><div class="line">其中%Q相当于&quot;&quot;,%q相当于&apos;&apos;。</div></pre></td></tr></table></figure>
</li>
<li><p>Here Document方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;&lt;&quot;结束标识&quot;  </div><div class="line">内容</div><div class="line">结束标识</div><div class="line"></div><div class="line">#=&gt; (这里更多的时候要换成&lt;&lt;-&quot;结束标识&quot;，这样能让结束的标识不一定在)</div><div class="line"></div><div class="line">这个方法应该很少用。</div></pre></td></tr></table></figure>
</li>
<li><p><code>sprintf方法</code> &amp; <code>printf方法</code></p>
<ul>
<li><code>printf</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">n = 123</div><div class="line">printf(&quot;%d\n&quot;, n)       #=&gt; %d表示以整数形式输出</div><div class="line">printf(&quot;%4d\n&quot;, n)      #=&gt; %4d表示以4位数格式输出</div><div class="line">printf(&quot;%04d\n&quot;, n)     #=&gt; %04d表示不够4位时被零</div><div class="line">printf(&quot;%+d\n&quot;, n)      #=&gt; %+d表示输出结果带 + or -</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">n = &quot;Ruby&quot;</div><div class="line">printf(&quot;Hello,%s!\n&quot;,n)     #=&gt; %s表示以字符串形式输出</div><div class="line">printf(&quot;Hello,%8s!\n&quot;,n)    #=&gt; %8s表示输出炎8位字符串</div><div class="line">printf(&quot;Hello,%-8s!\n&quot;,n)   #=&gt; %-8s表示输出左对齐的8位字符</div></pre></td></tr></table></figure>
<ul>
<li><code>sprintf</code></li>
</ul>
<p>和<code>printf</code>一样的结果。但书中没有说明具体区别，差评！</p>
</li>
</ul>
</li>
<li><p>获取字符串的长度</p>
<ul>
<li><code>length</code> or <code>size</code>两种方法可以，随意！</li>
<li><code>bytesize</code>可以获取字节数。</li>
<li>判断是否为0：<code>empty?</code></li>
</ul>
</li>
<li><p>字符串的索引</p>
<ul>
<li>当成数组一样用就可以了。</li>
</ul>
</li>
<li><p>连接字符串</p>
<ul>
<li><p>用 <code>+</code> 号</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">a = &quot;Hello,&quot;</div><div class="line">b = &quot;World!&quot;</div><div class="line">a + b           #=&gt; &quot;Hello,World!&quot;</div></pre></td></tr></table></figure>
</li>
<li><p>用 <code>&lt;&lt;</code> 号</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">a = &quot;Hello,&quot;</div><div class="line">b = &quot;World!&quot;</div><div class="line">a &lt;&lt; b          #=&gt; &quot;Hello,World!&quot;   (a会被改变！)</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>字符串的比较</p>
<ul>
<li><p>判断两个字符串是否相同：<code>==</code> <code>!=</code></p>
</li>
<li><p>比较大小</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&quot;aaaaa&quot; &lt; &quot;b&quot;     #=&gt; true    一般按照a~z的顺序排序</div></pre></td></tr></table></figure>
</li>
<li><p>如果查看<code>码位</code> : <code>.ord</code></p>
</li>
</ul>
</li>
<li><p>字符串的分割：<code>split(x)</code> ：以<code>x</code>为分割点进行分割！</p>
</li>
<li><p>换行符的操作：</p>
<ul>
<li><p>删掉</p>
<p>|  属性   | 删掉最的一个字符 | 删掉挑选符  |<br>| :—: | :——: | :—-: |<br>| 非破坏性的 |   chop   | chomp  |<br>| 破坏性的  |  chop!   | chomp! |</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">a = &quot;abcde&quot;</div><div class="line">b = &quot;abcde\n&quot;</div><div class="line">a.chop         #=&gt; &quot;abcd&quot;</div><div class="line">b.chop         #=&gt; &quot;abcde&quot;</div><div class="line">b.chomp        #=&gt; &quot;abcde&quot;</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>字符串的检索与置换</p>
<ul>
<li><p>字符串的检索</p>
<ul>
<li><code>index方法</code> 从左到右检索，返回第一个字母的索引</li>
<li><code>rindex方法</code> 从右到左检索，返回第一字母的索引</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">a = &quot;abbbbbb&quot;</div><div class="line">a.index(&quot;bb&quot;)     #=&gt; 1</div><div class="line">a.rindex(&quot;bb&quot;)    #=&gt; 5</div></pre></td></tr></table></figure>
</li>
<li><p>判断是否包含某个索引值: <code>include?</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">a = &quot;abbbbbb&quot;</div><div class="line">a.include?(&quot;bb&quot;)    #=&gt; true</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>字符串与数组有很多共同的索引的方法：</p>
</li>
</ol>
<ul>
<li><code>s[n]</code> <code>s[n..m]</code> <code>s.slice!(n)</code> </li>
<li><code>s.concat(s2)</code> <code>s+s2</code> <code>s.delete(str)</code> <code>s.reverse</code></li>
</ul>
<ol>
<li><p>其他方法：</p>
<ul>
<li><p><code>strip</code> : 删除头尾的空白字符</p>
</li>
<li><p><code>upcase</code> ：小写转大写</p>
</li>
<li><p><code>downcase</code> ：大写转小写</p>
</li>
<li><p><code>swapcase</code> ：大的转小，小的转大</p>
</li>
<li><p><code>capitalize</code> ：首字母大写，其余转小写</p>
</li>
<li><p><code>tr</code> ：置换字符，与<code>gsub</code>相似，但这里可以一次转换多个字符。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&quot;ABCDE&quot;.tr(&quot;BD&quot;, &quot;bd&quot;)    #=&gt; &quot;AbCdE&quot;</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<h5 id="14章节练习题提取："><a href="#14章节练习题提取：" class="headerlink" title="14章节练习题提取："></a>14章节练习题提取：</h5><ol>
<li><p>一个打散的字符串数组，如何快速连接成句子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">a = [&quot;Ruby&quot;, &quot;is&quot;, &quot;an&quot;, &quot;object&quot;, &quot;oriented&quot;, &quot;programming&quot;, &quot;language&quot;]</div><div class="line">a.join(&quot; &quot;)   </div><div class="line">#=&gt; &quot;Ruby is an object oriented programming language&quot;</div></pre></td></tr></table></figure>
</li>
<li><p>统计下面各个字母出现次数，并用*的个数来表示次数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">a = &quot;Ruby is an object oriented programming language&quot;</div><div class="line">b = Hash.new(0)</div><div class="line">a.each_char do |c|</div><div class="line">  b[c] += 1</div><div class="line">end</div><div class="line">b.sort.each do |k, v|</div><div class="line">  printf(&quot;&apos;%s&apos;: %s\n&quot;, c, &quot;*&quot; * v.to_i)</div><div class="line">end</div></pre></td></tr></table></figure>
<p>运行结果如图：</p>
<p><img src="http://olmrxx9ks.bkt.clouddn.com/ipic/2017-07-17-094146.jpg" alt=""></p>
<p>很酷！</p>
<ul>
<li>散列直接用<code>a[c]</code>就可以拿到这个值，不需要进行检索</li>
<li><code>printf</code>格式输出，方便！先定义好整个字符串样式，再后面定义各个引用值。</li>
</ul>
<p>​</p>
</li>
</ol>
<h4 id="散列类"><a href="#散列类" class="headerlink" title="散列类"></a>散列类</h4><ol>
<li><p>新建hash:</p>
<ul>
<li><code>a = {}</code> <code>a = {键: 值}</code></li>
<li><code>a = Hash.new(x)</code>  （这里可以设置一个默认值）。</li>
</ul>
</li>
<li><p>值的获取与设定</p>
<ul>
<li><p><code>fetch</code>  &amp; <code>store</code>  一个用来取一个用来存，基本和<code>a[&quot;s&quot;]</code>的作法一样，但：</p>
<p>用下面两个方法可以</p>
<ul>
<li>设默认值</li>
<li>添加block</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">a.store(&quot;s1&quot;, &quot;Ruby&quot;)</div><div class="line">a.fetch(&quot;s2&quot;, &quot;undef&quot;)     #=&gt; &quot;undef&quot;   (找不到，所以默认值)</div><div class="line">a.fetch(&quot;s2&quot;)&#123;String.new&#125;  #=&gt; &quot;&quot;    (这里还可以用block)</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>hash的迭代器。</p>
<p>|  数组形式  |         迭代器形式         |<br>| :—-: | :——————-: |<br>|  keys  |  each_key{|键| …… }  |<br>| Values | each_value{|值| …… } |<br>|  to_a  |   each{|键，值| …… }   |<br>|        |   each{|数组| …… }    |</p>
</li>
<li><p>hash的默认值。好处：<strong><u>取不存在的值时，不至于发生错误</u></strong>。</p>
<ul>
<li><p>创建hash时指定默认值：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">h = Hash.new(1)</div><div class="line">h[&quot;a&quot;] = 10</div><div class="line">h[&quot;a&quot;]          #=&gt; 10</div><div class="line">h[&quot;b&quot;]          #=&gt; 1</div></pre></td></tr></table></figure>
</li>
<li><p>创建hash时增加一个block：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">h = Hash.new do |hash,key|</div><div class="line">  hash[key] = key.upcase</div><div class="line">end</div><div class="line">h [&quot;a&quot;] = &quot;b&quot;</div><div class="line">p h[&quot;a&quot;]      #=&gt; &quot;b&quot;</div><div class="line">p h[&quot;b&quot;]      #=&gt; &quot;B&quot;</div><div class="line">p h[&quot;c&quot;]      #=&gt; &quot;C&quot;  当找不到这个值时，就会自动去执行这个block</div></pre></td></tr></table></figure>
</li>
<li><p>用fetch方法指定默认值：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">h = Hash.new do |hash.key|</div><div class="line"> hash[key] = key.upcase</div><div class="line">end</div><div class="line">p h.fetch(&quot;x&quot;, &quot;(undef)&quot;)      #=&gt; &quot;(undef)&quot;</div><div class="line">同时两个默认值的方法，fetch的优级级会高</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>判断是否为某个Hash的<code>键</code> or <code>值</code> </p>
<ul>
<li>键<ul>
<li><code>h.key?(key)</code></li>
<li><code>h.has_key?(key)</code></li>
<li><code>h.include?(key)</code></li>
<li><code>h.member?(key)</code></li>
</ul>
</li>
<li>值<ul>
<li><code>h.value?(value)</code></li>
<li><code>h.has_value?(value)</code></li>
</ul>
</li>
</ul>
</li>
<li><p>查看Hash的大小</p>
<ul>
<li><p><code>h.size</code> &amp; <code>h.length</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">h = &#123;&quot;a&quot; =&gt; &quot;b&quot;, &quot;c&quot; =&gt; &quot;d&quot;&#125;</div><div class="line">h.size      #=&gt; 2</div></pre></td></tr></table></figure>
</li>
<li><p><code>h.empty?</code></p>
</li>
</ul>
</li>
<li><p>删除值：</p>
<ul>
<li><p><code>h.delete(key)</code></p>
</li>
<li><p><code>h.delete_if{|key, val| … }</code></p>
</li>
<li><p><code>h.reject!{|key, val| … }</code></p>
<p>当不符合时，<code>delete_if</code>会返回原来的Hash,<code>reject!</code>会返回一个nil</p>
</li>
</ul>
</li>
<li><p>初始化散列</p>
<ul>
<li><p><code>h.clear</code> 清空使用过的散列</p>
<blockquote>
<p>那这个东西和<code>h = Hash.new</code> 有什么区别呢？在引用的时候要注意下，请看图：<br><img src="http://olmrxx9ks.bkt.clouddn.com/2017-07-23-124646.jpg" alt=""></p>
</blockquote>
</li>
<li><p>我忘记了一个超级方便的排序方法：<code>sort</code><br>PS:比起之学VB时的什么泡沫排序法之类的，这里简直不能太好！</p>
</li>
</ul>
</li>
</ol>
<h4 id="正在表达式-Regexp类"><a href="#正在表达式-Regexp类" class="headerlink" title="正在表达式(Regexp类)"></a>正在表达式(Regexp类)</h4><ol>
<li><p>正则表达式的创建：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">re = Regexp.new(&quot;Ruby&quot;)      #=&gt; /Ruby/</div></pre></td></tr></table></figure>
<ul>
<li><code>%r(模式)</code></li>
<li><code>%r&lt;模式&gt;</code></li>
<li><code>%r|模式|</code></li>
<li><code>%r!模式!</code></li>
</ul>
</li>
<li><p>判断某个字符串是否匹配：<code>正则表达式 =~ 字符串</code></p>
<ul>
<li><p>匹配：返回匹配的起始位置</p>
</li>
<li><p>不匹配：返回nil</p>
<blockquote>
<p>还可以：用<code>!~</code>来颠倒结果。</p>
</blockquote>
</li>
<li><p>进一步应用:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">if 正则表达式 =~ 字符串</div><div class="line">  匹配时的处理</div><div class="line">else</div><div class="line">  不匹配时的处理</div><div class="line">end</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>匹配行首与行尾：</p>
<p><code>^, $</code>分别表示匹配行首与行尾：</p>
<blockquote>
<p>像这样的特殊字符称为：元字符。</p>
</blockquote>
<p><code>\A,\z</code>分别表示匹配字符串头与尾：</p>
<blockquote>
<p><code>\z</code> <code>\Z</code> 两者的区别</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; p &quot;abc\n&quot;.gsub(/\z/, &quot;!&quot;) =&gt; &quot;abc\n!&quot; </div><div class="line">&gt; p &quot;abc\n&quot;.gsub(/\Z/, &quot;!&quot;) =&gt; &quot;abc!\n!&quot;</div><div class="line">&gt;</div></pre></td></tr></table></figure>
</blockquote>
<p>&gt;</p>
<blockquote>
<p>：大写的<code>\Z</code>，如果最后一个是换行符，则会同时匹配换行符与前一个字符。</p>
</blockquote>
</li>
<li><p>匹配某一个字符：</p>
<ul>
<li><code>[AB]</code> ：匹配A 或B</li>
<li><code>[ABC]</code> ：匹配A,B,C中的一个</li>
<li><code>[012ABC]</code> ：匹配0,1,2,A,B,C中的一个</li>
<li><code>[A-Z]</code> ：匹配A~Z中的一个</li>
<li><code>[ABC][BC]</code> ： 匹配一个两位数，第一个数为A,B,C中的一个，第二位数为B,C中的一个。</li>
<li><code>[A_-]</code> ：匹配<code>A</code> <code>_</code> <code>-</code> 中的一个。</li>
<li><code>[^ABC]</code> ：匹配除A,B,C外的任意一位数。</li>
<li><code>.</code> ：万能通配符，相当于五笔中的<code>z</code></li>
</ul>
</li>
<li><p>反斜杠模式</p>
<ul>
<li><p><code>\s</code> ： 匹配空格，制表符， 换行符，换页符</p>
</li>
<li><p><code>\d</code> ：匹配0到9的数字。</p>
</li>
<li><p><code>\w</code> ：匹配英文字与数字。</p>
</li>
<li><p><code>\A</code> ：匹配字符串的开头。</p>
</li>
<li><p><code>\z</code> ：匹配字符串的末尾。</p>
</li>
<li><p><code>\</code>   ：后面如果跟着：<code>^</code> <code>$</code> <code>[</code> 等字符时，可以为这些字符转义再匹配。如：</p>
<p>| 模式      | 字符串       | 匹配部分         |<br>| ——- | ——— | ———— |<br>| /ABC[/ | “ABC[“    | “▶ ABC[ ◀”   |<br>| /\^ABC/ | “ABC”     | (不匹配)        |<br>| /\^ABC/ | “012^ABC” | “012▶^ABC ◀” |</p>
</li>
</ul>
</li>
<li><p>重复模式：(单个字符)</p>
<ul>
<li><code>*</code> ：重复0次以上。<strong><u>可以重复很多次也可以直接没有</u></strong></li>
<li><code>+</code> ：重复1次以上。<strong><u>至少有一次以上</u></strong></li>
<li><code>?</code> ：重复0次或1次。<strong><u>可有可无不重复，前后的匹配还是要的！</u></strong></li>
</ul>
</li>
<li><p>最短匹配：</p>
<ul>
<li><p>上面6中和重复匹配会最可能匹配更多的字符。</p>
</li>
<li><p>最短匹配：加上一个<code>?</code> ，在第一次匹配时就停止，匹配最短的字符。</p>
<blockquote>
<p>也叫贪婪匹配与懒惰匹配。</p>
</blockquote>
</li>
</ul>
</li>
<li><p>使用<code>()</code>来重复匹配多个字符。</p>
<p>| 模式         | 字符串        | 匹配部分        |<br>| ———- | ———- | ———– |<br>| /^(ABC)<em>$/ | “ABC”      | “▶ABC ◀”    |<br>| /^(ABC)</em>$/ | “”         | “▶◀”        |<br>| /^(ABC)<em>$/ | “ABCABC”   | “▶ABCABC ◀” |<br>| /^(ABC)</em>$/ | “ABCABCAB” | (不匹配)       |</p>
</li>
<li><p>使用<code>|</code>来多一个匹配选项，可以多选一，也可以全中。</p>
<p>| 模式             | 字符串   | 匹配部分     |<br>| ————– | —– | ——– |<br>| /^(ABC|DEF)$/ | “ABC” | “▶ABC ◀” |<br>| /^(ABC|DEF)$/ | “DEF” | “▶DEF ◀” |<br>| /^(ABC|DEF)$/ | “AB”  | (不匹配)    |</p>
</li>
<li><p>使用<code>quote方法</code>来转义所有表达式所有字符：</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">re1 = Regexp.new(&quot;abc*def&quot;)</div><div class="line">re2 = Regexp.new(Regexp.quote(&quot;abc*def&quot;)) p (re1 =~ &quot;abc*def&quot;) #=&gt; nil</div><div class="line">p (re2 =~ &quot;abc*def&quot;) #=&gt; 0</div></pre></td></tr></table></figure>
<ol>
<li><p>正则表达式的一些选项：</p>
<blockquote>
<p>形式：<code>/ … / im</code></p>
</blockquote>
<ul>
<li><code>i</code> ：忽略英文有大小写</li>
<li><code>x</code> ：忽略正则表达式中的空白字符以及 # 后面的字符的选项。指定这个选项后，我们就可以使用 # 在正则表达式中写注释了。</li>
<li><code>m</code> ：使用后可以：用<code>.</code>匹配换行符了。</li>
</ul>
</li>
<li><p>捕获：</p>
<ul>
<li><p>查看匹配的部分是什么字符串：以<code>()</code>的形式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">/(.)(.)(.)/ =~ &quot;abc&quot; first = $1</div><div class="line">second = $2</div><div class="line">third = $3</div><div class="line">p first      #=&gt; &quot;a&quot;</div><div class="line">p second     #=&gt; &quot;b&quot;</div><div class="line">p third      #=&gt; &quot;c&quot;</div></pre></td></tr></table></figure>
</li>
<li><p>如果是有重复的匹配只会捕获最后一次的字符，如果此时我们想忽略它的捕获，可以这样：以<code>(?:)</code>开头就可以忽略捕获。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">/(.)(\d\d)+(.)/ =~ &quot;123456&quot;</div><div class="line">p$1 #=&gt; &quot;1&quot;</div><div class="line">p$2 #=&gt; &quot;45&quot;</div><div class="line">p$3 #=&gt; &quot;6&quot;</div><div class="line">/(.)(?:\d\d)+(.)/ =~ &quot;123456&quot; </div><div class="line">p $1 #=&gt; &quot;1&quot;</div><div class="line">p $2 #=&gt; &quot;6&quot;</div></pre></td></tr></table></figure>
</li>
<li><p>另外一种形式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">/C./ =~ &quot;ABCDEF&quot;</div><div class="line">p $`   #=&gt; &quot;AB&quot;</div><div class="line">p $&amp;   #=&gt; &quot;CD&quot;</div><div class="line">p $&apos;   #=&gt; &quot;EF&quot;</div><div class="line">  这三种可以捕获整个匹配过程的字符</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>sub方法与gsub方法：带block</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">str = &quot;abracatabra&quot;</div><div class="line">nstr = str.sub(/.a/) do |matched|</div><div class="line">  &apos;&lt;&apos;+matched.upcase+&apos;&gt;&apos; </div><div class="line">end</div><div class="line">p nstr #=&gt; &quot;ab&lt;RA&gt;catabra&quot;</div><div class="line">nstr = str.gsub(/.a/) do |matched|</div><div class="line">  &apos;&lt;&apos;+matched.upcase+&apos;&gt;&apos;</div><div class="line">end </div><div class="line">p nstr #=&gt; &quot;ab&lt;RA&gt;&lt;CA&gt;&lt;TA&gt;b&lt;RA&gt;&quot;</div></pre></td></tr></table></figure>
<p>可以带block，然后把匹配的部分传入block，最后block处理后的结果置换匹配的字符串。</p>
</li>
<li><p>直接返回的字符串数组：<code>scan方法</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p &quot;abracatabra&quot;.scan(/.a/) #=&gt; [&quot;ra&quot;, &quot;ca&quot;, &quot;ta&quot;, &quot;ra&quot;]</div></pre></td></tr></table></figure>
</li>
</ol>
<blockquote>
<p>这是纠正一点：转义符号增加的顺序：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt;  /http:\/\// =~ &quot;http://baidu.com&quot;   </div><div class="line">&gt;  $&amp;    #=&gt; &quot;http://&quot;        </div><div class="line">&gt;</div></pre></td></tr></table></figure>
</blockquote>
<p>&gt;</p>
<blockquote>
<p>纠正：<code>\+要转义的符号</code> 这才是正确的格式。</p>
</blockquote>
<h4 id="章节：IO类"><a href="#章节：IO类" class="headerlink" title="章节：IO类"></a>章节：IO类</h4><blockquote>
<p>这一章节主要对文件内容的操作。暂时不会用到，理解起来也费劲。</p>
</blockquote>
<h4 id="章节：File类与Dir类"><a href="#章节：File类与Dir类" class="headerlink" title="章节：File类与Dir类"></a>章节：File类与Dir类</h4><blockquote>
<p>这一章节主要是对文件夹的操作。暂时不会用到，记起来也很费劲。</p>
</blockquote>
<h4 id="章节：Encoding类"><a href="#章节：Encoding类" class="headerlink" title="章节：Encoding类"></a>章节：Encoding类</h4><blockquote>
<p>这一章节主要是编码类的讲解。暂时不会用到，要用到时再来查看。</p>
</blockquote>
<h4 id="第20章-Time类与Date类"><a href="#第20章-Time类与Date类" class="headerlink" title="第20章 Time类与Date类"></a>第20章 Time类与Date类</h4><ol>
<li><p>获取当前时间：</p>
<ul>
<li><code>Time.new</code></li>
<li><code>Time.now</code></li>
</ul>
<p>时间相关的方法：</p>
<p>| 方法名   | 意义                       |<br>| —– | ———————— |<br>| year  | 年                        |<br>| month | 月                        |<br>| day   | 日                        |<br>| hour  | 时                        |<br>| min   | 分                        |<br>| sec   | 秒                        |<br>| usec  | <code>秒以下的位数(以毫秒为单位)</code>         |<br>| to_i  | 从 1970 年 1 月 1 日到当前时间的秒数 |<br>| wday  | 一周中的第几天(0 表示星期天)         |<br>| mday  | 一个月中的第几天(与 day 方法一样)     |<br>| yday  | 一年中的第几天(1 表示 1 月 1 日)    |<br>| zone  | 时区(JST 等)                |</p>
</li>
<li><p>指定特定时间：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">t = Time.mktime(2017,7,25,16.59,40)</div><div class="line">#=&gt; 2017-07-25 16:40:00 +0800</div></pre></td></tr></table></figure>
</li>
<li><p>时间的比较：</p>
<ul>
<li><code>&lt;</code> <code>&gt;</code> <code>-</code> 等，平常的计算比较方法都可以用啦。</li>
</ul>
</li>
<li><p>时间的计算：默认直接计算秒数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">t = Time.now</div><div class="line">p t #=&gt; 2013-03-30 03:11:44 +0900 t2=t+60*60*24 #=&gt;增加24小时的秒数</div><div class="line">p t2 #=&gt; 2013-03-31 03:11:44 +0900</div></pre></td></tr></table></figure>
</li>
<li><p>时间输出的格式：</p>
<ul>
<li><code>t.strftime(format)</code></li>
<li><code>t.to_s</code></li>
</ul>
<p>| 格式   | 意义与范围                            |<br>| —- | ——————————– |<br>| %A   | 星期的名称(Sunday 、 Monday ……)    |<br>| %a   | 星期的缩写名称(Sun 、 Mon ……)        |<br>| %B   | 月份的名称(January 、 February ……) |<br>| %b   | 月份的缩写(Jan 、 Feb ……)          |<br>| %c   | 日期与时间                            |<br>| %d   | 日(01 ~ 31)                       |<br>| %H   | 24 小时制(00 ~ 23)                  |<br>| %I   | 12 小时制(01 ~ 12)                  |<br>| %j   | 一年中的天(001 ~ 366)                 |<br>| %M   | 分(00 ~ 59)                       |<br>| %m   | 表示月的数字(01 ~ 12)                  |<br>| %p   | 上午或下午(AM、PM)                     |<br>| %S   | 秒(00 ~ 60)                       |<br>| %U   | 表示周的数字。以星期天为一周的开始(00 ~ 53)       |<br>| %W   | 表示周的数字。以星期一为一周的开始(00 ~ 53)       |<br>| %w   | 表示星期的数字。0 表示星期天(0 ~ 6)           |<br>| %X   | 时间                               |<br>| %x   | 日期                               |<br>| %Y   | 表示西历的数字                          |<br>| %y   | 西历的后两位(00 ~ 99)                  |<br>| %Z   | 时区( JST 等)                       |<br>| %z   | 时区(+0900 等)                      |<br>| %%   | 原封不动地输出 %                        |</p>
<p>示例：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">t = Time.now.strftime(<span class="string">"%Y-%m-%d"</span>)</div><div class="line"><span class="comment">#=&gt; "2017-7-25"</span></div></pre></td></tr></table></figure>
<h6 id="另外两个冷门的格式：-需要引用time类"><a href="#另外两个冷门的格式：-需要引用time类" class="headerlink" title="另外两个冷门的格式：(需要引用time类)"></a><u>另外两个冷门的格式</u>：(需要引用time类)</h6><ul>
<li><code>t.rfc2822</code></li>
<li><code>t.iso8601</code>f</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">require &quot;time&quot;</div><div class="line">t = Time.now</div><div class="line">p t.rfc2822      #=&gt; &quot;Tue, 25 Jul 2017 17:19:00 +0800&quot;</div><div class="line">p t.iso8601      #=&gt; &quot;2017-07-25T17:19:42+08:00&quot;</div></pre></td></tr></table></figure>
</li>
<li><p>本地时间与国际时间的切换：</p>
<ul>
<li><code>t.utc</code></li>
<li><code>t.localtime</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">t = Time.now</div><div class="line">p t            #=&gt;  2017-07-25 17:21:35 +0800</div><div class="line">t.utc          #=&gt;  2017-07-25 09:21:35 UTC</div><div class="line">t.localtime    #=&gt;  2017-07-25 17:21:35 +0800</div></pre></td></tr></table></figure>
</li>
<li><p>从字符串中获取时间：</p>
<ul>
<li><p><code>Time.parse(str)</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">require &quot;time&quot;</div><div class="line"></div><div class="line">p Time.parse(&quot;2017-7-25&quot;)   #=&gt; 2017-07-25 00:00:00 +0800</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>日期的获取：Date类，适合只需日期不需时间的操作。</p>
<ul>
<li><p><code>Date.today</code></p>
</li>
<li><p>计算：直接加减默认计算天数</p>
</li>
<li><p>同样也有各种方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">d = Date.today</div><div class="line">p d.year pd.month pd.day</div><div class="line">p d.wday p d.mday pd.yday</div><div class="line"># 年 =&gt; 2017</div><div class="line">#月 =&gt; 7</div><div class="line">#日 =&gt; 25</div><div class="line"># 一周中的第几天(0 表示星期天)</div><div class="line"># 一个月中的第几天(与 day 方法一样) =&gt; 30 #一年中的第几天(1表示 1月 1日) =&gt;206</div></pre></td></tr></table></figure>
</li>
<li><p>用指定日期生成Date对象：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">d = Date.new(2017,7,25)</div><div class="line">puts d     #=&gt; 2017-7-25</div></pre></td></tr></table></figure>
<blockquote>
<p>还可以用<code>-1</code> <code>-2</code> 表示末尾的第几天：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; d = Date.new(2017,7,-1)   #=&gt; 2017-7-31   7月月尾</div><div class="line">&gt; d = Date.new(2017,7,-2)   #=&gt; 2017-7-30   7月月尾前一天</div><div class="line">&gt;</div></pre></td></tr></table></figure>
</blockquote>
</li>
</ul>
</li>
<li><p>Date类的运算：</p>
<ul>
<li>正常的加减，默认会以天数为单位计算</li>
<li><code>&gt;&gt;</code> <code>&lt;&lt;</code> 会以月份为单位进行运算。</li>
</ul>
</li>
<li><p>Date类的格式：</p>
</li>
</ol>
<ul>
<li>与前面的Time类一致。</li>
</ul>
<ol>
<li>从字符串中获取Date类：<ul>
<li>和Time类一致： <code>Date.parse(str)</code></li>
</ul>
</li>
</ol>
<h4 id="Proc类"><a href="#Proc类" class="headerlink" title="Proc类"></a>Proc类</h4><ol>
<li><p>什么是proc类，</p>
<blockquote>
<p>把block块变成一个对象，这个对象所属的类就是Proc类。这样可以方便我们在后面的调用。</p>
</blockquote>
</li>
<li><p>创建方法：</p>
<ul>
<li><code>Proc.new(…)</code></li>
<li><code>proc{}</code></li>
</ul>
</li>
<li><p>调用方法：</p>
<ul>
<li><p>利用<code>Proc#call</code>方法</p>
</li>
<li><p>利用<code>Proc[]</code>方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">sayhello = Proc.new do |name|</div><div class="line">  puts &quot;Hello, #&#123;name&#125;.&quot;</div><div class="line">end</div><div class="line"></div><div class="line">sayhello.call(&quot;World&quot;)    #=&gt; Hello, World.</div><div class="line">sayhello[&quot;World&quot;]         #=&gt; Hello, World.</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>另一种写法：<code>lambda</code></p>
<blockquote>
<p><code>lambda</code> 还有另外一种写法：<code>-&gt; (块变量){处理}</code> </p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">prc1 = Proc.new do |a, b, c|</div><div class="line">  p [a, b, c]</div><div class="line">end</div><div class="line">prc1.call(1,2)     #=&gt; [1, 2, nil]</div><div class="line"></div><div class="line">prc2 = lambda do |a, b, c|</div><div class="line">  p [a, b, c]</div><div class="line">end</div><div class="line">prc2.call(1,2)     #=&gt; 错误 (ArgumentError)</div></pre></td></tr></table></figure>
<p><code>lambda</code> <code>proc</code> 两者的区别：</p>
<ul>
<li>lambda的参数数量要对应否则会出错，proc的参数数量则没有那么严格。</li>
<li>lambda可以使用return将值从块中返回。</li>
</ul>
</li>
<li><p>proc类可以接收块</p>
</li>
<li><p>proc的特征：</p>
<blockquote>
<p>具有闭包的特征。 闭包：将处理内容、变量等环境同时进行保存的对象，在编程语言中称为闭包(closure)。</p>
</blockquote>
</li>
<li><p>proc的实例方法：</p>
<ul>
<li><code>prc.call(args,…)</code></li>
<li><code>prc[args, … ]</code></li>
<li><code>prc.yield(args, … )</code></li>
<li><code>prc.(args, … )</code></li>
<li><code>prc === arg</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">prc = Proc.new&#123;|a, b| a + b&#125;</div><div class="line">p prc.call(1, 2)    #=&gt; 3</div><div class="line">p prc[3, 4]         #=&gt; 7</div><div class="line">p prc.yield(5, 6)   #=&gt; 11</div><div class="line">p prc.(7, 8)        #=&gt; 15</div><div class="line">p prc === [9, 10]   #=&gt; 19</div></pre></td></tr></table></figure>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">fizz = proc&#123;<span class="params">|n|</span> n % <span class="number">3</span> == <span class="number">0</span> &#125;</div><div class="line">buzz = proc&#123;<span class="params">|n|</span> n % <span class="number">5</span> == <span class="number">0</span> &#125;</div><div class="line">fizzbuzz = proc&#123;<span class="params">|n|</span> n % <span class="number">3</span> == <span class="number">0</span> &amp;&amp; n % <span class="number">5</span> == <span class="number">0</span>&#125; </div><div class="line">(<span class="number">1</span>..<span class="number">100</span>).each <span class="keyword">do</span> <span class="params">|i|</span></div><div class="line">  <span class="keyword">case</span> i</div><div class="line">    <span class="keyword">when</span> fizzbuzz <span class="keyword">then</span> puts <span class="string">"Fizz Buzz"</span> </div><div class="line">    <span class="keyword">when</span> fizz <span class="keyword">then</span> puts <span class="string">"Fizz"</span></div><div class="line">    <span class="keyword">when</span> buzz <span class="keyword">then</span> puts <span class="string">"Buzz"</span></div><div class="line">  <span class="keyword">else</span></div><div class="line">    puts i</div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<ul>
<li><code>prc.arity</code> ： 返回块变量的个数。</li>
<li><code>prc.parameters</code><br><img src="http://olmrxx9ks.bkt.clouddn.com/2017-07-25-Snip20170726_5.png" alt=""></li>
<li><code>prc.lambda?</code> ：判断是否通过lambda定义的方法。</li>
<li><code>prc.source_location</code>： 返回值为[代码文件名，行编号]</li>
</ul>
</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/archives/2017/08/03/2017-08-03-the-second-part-of-the-tutorial-ruby-base-extraction/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="黄鸿亮">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://olmrxx9ks.bkt.clouddn.com/2017-09-07-080115.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Activeliang's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/archives/2017/08/03/2017-08-03-the-second-part-of-the-tutorial-ruby-base-extraction/" itemprop="url">《ruby基础教程》第二部分 提取</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-03T01:25:00+08:00">
                2017-08-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="第2部分-Ruby的基础："><a href="#第2部分-Ruby的基础：" class="headerlink" title="第2部分 Ruby的基础："></a>第2部分 Ruby的基础：</h4><ol>
<li><p>什么是对象：在RUBY中， 靓丽数据的基本单位称为对象。</p>
<ul>
<li>数值对象</li>
<li>字符串对象</li>
<li>数组对象，散列对象</li>
<li>正则表达式对象</li>
<li>时间对象</li>
<li>文件对象</li>
<li>符号对象</li>
</ul>
</li>
<li><p>什么是类：表示对象的种类。</p>
<p><img src="http://olmrxx9ks.bkt.clouddn.com/blog/2017-07-05-Snip20170705_9.png" alt=""></p>
</li>
<li><p>什么是伪变量：代表某特定值的特殊量。</p>
<ul>
<li><code>nil</code> <code>true</code> <code>false</code> <code>self</code></li>
</ul>
</li>
<li><p>常量：</p>
<ul>
<li>常量以大写英文字母开头。</li>
<li>给常量重复定义时，ruby会做出警告。</li>
</ul>
</li>
<li><p>多重赋值里还可以这样用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ary = [1,2]</div><div class="line">a,b = ary          #=&gt; a=1, b=2</div></pre></td></tr></table></figure>
</li>
<li><p>比较值是否相等时，通常用<code>==</code> ，但如果要严谨一点的，就用<code>eql?</code></p>
</li>
<li><p>一些控制循环的语句：</p>
<p><img src="http://olmrxx9ks.bkt.clouddn.com/blog/2017-07-05-Snip20170705_11.png" alt=""></p>
</li>
<li><p>语法糖(syntaxsugar),是指一种为了照顾一般人习惯而产生的特殊语法</p>
</li>
</ol>
<h5 id="方法："><a href="#方法：" class="headerlink" title="方法："></a>方法：</h5><ol>
<li><p>什么是方法：把一系统参数传递给对象的过程。（对象会返回结果值）</p>
</li>
<li><p>方法的调用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">对象.方法名(参数1， 参数2， ...， 参数n)</div></pre></td></tr></table></figure>
</li>
<li><p>方法的分类：</p>
<ul>
<li><p>实例方法：作用在实例上的方法。</p>
</li>
<li><p>类方法：作用在类上的方法。调用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">类名.方法名</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">类名::方法名</div></pre></td></tr></table></figure>
</li>
<li><p>函数式方法：没有作用对象的方法，也没有回传值。</p>
</li>
</ul>
</li>
<li><p>参数个数不确定的方法，使用带<code>*</code>号的参数：</p>
<p>这个参数组会被封装为数组供内部使用。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">def	foo(*args)</div><div class="line">  args</div><div class="line">end</div><div class="line"></div><div class="line">p foo(1,2,3)       #=&gt; [1,2,3]</div><div class="line">p foo(1,2)         #=&gt; [1,2]</div></pre></td></tr></table></figure>
<p>至少需要一个参数的方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">def	meth(arg, *args)</div><div class="line">  [arg, args]</div><div class="line">end</div><div class="line"></div><div class="line">p meth(1)     #=&gt; [1, []]</div><div class="line">p meth(1,2,3) #=&gt; [1, [2,3]]</div></pre></td></tr></table></figure>
<p>首尾确定，中间不确定时：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">def	a(a, *b, c)</div><div class="line">  [a,b,c]</div><div class="line">end</div><div class="line"></div><div class="line">p a(1,2,3,4,5)     #=&gt; [1, [2,3,4], 5]</div><div class="line">p a(1,2)           #=&gt; [1, [], 2]</div></pre></td></tr></table></figure>
</li>
<li><p>关键字参数：以hash形式传递参数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">def	a(a: 1, b: 2, c: 3)</div><div class="line">  [a,b,c]</div><div class="line">end</div></pre></td></tr></table></figure>
<p>如果想传递未定义的参数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">def a(a:1, **args)</div><div class="line">  [a, args]</div><div class="line">end</div><div class="line"></div><div class="line">p a(a: 2, k: 3, v: 4)    #=&gt; [2, &#123;:k =&gt; 3, :v =&gt; 4&#125;]</div></pre></td></tr></table></figure>
</li>
</ol>
<h5 id="类与模块："><a href="#类与模块：" class="headerlink" title="类与模块："></a>类与模块：</h5><ol>
<li><p>判断某个对象是否属于某个类时：<code>instance_of?</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">ary = []</div><div class="line">str = &quot;Hello world.&quot;</div><div class="line">p ary.instance_of?(Array)      #=&gt; true</div><div class="line">p str.instance_of?(String)     #=&gt; true</div><div class="line">p ary.instance_of?(String)     #=&gt; false</div><div class="line">p ary.instance_of?(Array)      #=&gt; false</div></pre></td></tr></table></figure>
</li>
<li><p>判断某个对象是否属于某个类时：<code>is_a?</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">str = &quot;This is a String.&quot;</div><div class="line">p str.is_a?(String)        #=&gt; true</div><div class="line">p str.is_a?(Object)        #=&gt; true</div></pre></td></tr></table></figure>
</li>
<li><p>常量：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">class HelloWorld</div><div class="line">  Version = &quot;1.0&quot;</div><div class="line">end</div></pre></td></tr></table></figure>
<p>调用时：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p HelloWorld::Version     #=&gt; &quot;1.0&quot;</div></pre></td></tr></table></figure>
</li>
<li><p><code>@@xxx</code>：类变量，可以多次修改。</p>
</li>
<li><p>限制访问级别：</p>
<ul>
<li><code>public</code> 公开，外部可以访问。一般默认方法都是<code>public</code>的，但<code>initialize</code>方法除外。</li>
<li><code>private</code>内部使用。外部无法访问。</li>
<li><code>protected</code>同一类中可以使用。外部无法使用。</li>
</ul>
</li>
<li><p>想知道一个类下有什么方法可以 被调用 ？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">类名.instance_methods</div></pre></td></tr></table></figure>
</li>
<li><p>为方法设置多个名字：<code>alias</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">alias 别名 原名</div><div class="line">alias :别名 :原名</div></pre></td></tr></table></figure>
</li>
<li><p>删除方法:  <code>undef 方法名</code>  or  <code>undef   :方法名</code></p>
</li>
<li><p>什么是单例类：只为了个实体对象服务的类和方法。</p>
</li>
</ol>
<h5 id="模块："><a href="#模块：" class="headerlink" title="模块："></a>模块：</h5><ol>
<li><p>使用方法：</p>
<ul>
<li><code>模块名.方法名</code></li>
<li>在类中<code>include 模块名</code>， 然后就可以直接使用方法啦~</li>
</ul>
</li>
<li><p>如果希望在外部可以用<code>模块名.方法名</code>，你可以这样做：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">module_function :hello</div></pre></td></tr></table></figure>
</li>
<li><p>如果想知道继承关系 ，可以使用：<code>ancestors</code>这个方法，如果想知道父类，可以使用方法：<code>superclass</code>。</p>
</li>
<li><p>调用时的优先级：</p>
<ul>
<li><code>类本身</code> =&gt; <code>引入的模块（最后引入模块的优先）</code> =&gt; <code>父类</code></li>
<li>重复引入，第二个引入的会被忽略。</li>
</ul>
</li>
<li><p><code>extend方法</code>：直接引入作用在对象上的模块。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">module  Edition</div><div class="line">  def  edition(n)</div><div class="line">    &quot;#&#123;self&#125;第#&#123;n&#125;版&quot;</div><div class="line">  end</div><div class="line">end</div><div class="line"></div><div class="line">str = &quot;Ruby 基础教程&quot;</div><div class="line">str.extend(Edition)     #=&gt; 将模块 Mix-in 进对象</div><div class="line"></div><div class="line">p str.edtion(4)         #=&gt; &quot;Ruby 基础教程第 4 版&quot;</div></pre></td></tr></table></figure>
<ul>
<li><p>也可以用<code>extend</code>来代替继承：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">class MyClass</div><div class="line">  extend ClassMethods</div><div class="line">end</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><code>.ceil</code>：进位的意思，会把对象变成大一位的整数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">a=3.23</div><div class="line">b=5.8</div><div class="line">a.ceil     #=&gt; 4</div><div class="line">b.ceil     #=&gt; 6</div></pre></td></tr></table></figure>
</li>
</ol>
<h5 id="运算符："><a href="#运算符：" class="headerlink" title="运算符："></a>运算符：</h5><ol>
<li><p>一直以为<code>||</code>就是<code>or</code>的意思（visual basic中的<code>or</code>），今天才发现，我错了：</p>
<p><strong><u>其实这两个符号不仅可以用在判断，还可以用在运算！！！</u></strong></p>
<ul>
<li><code>||</code> ：从左到右，返回第一个不为 <strong><u>fasle</u></strong> 或 <strong><u>nil</u></strong> 的值。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">a = false || nil || 2 || 3     #=&gt; a = 2</div></pre></td></tr></table></figure>
<ul>
<li><code>&amp;&amp;</code> ：返回最后一个真值（期间不能出现假值）。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">a = 1 &amp;&amp; 2 &amp;&amp; 3 &amp;&amp; 4     #=&gt; a = 4</div><div class="line">a = nil &amp;&amp; false &amp;&amp; 1    #=&gt; a = nil</div></pre></td></tr></table></figure>
<ul>
<li><p><code>||=</code> ：当为 <strong><u>false</u></strong> 或 <strong><u>nil</u></strong> 时，才进行赋值。（这可给变量赋予默认值 ）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">var ||= 1     #=&gt; 当var为nil或false时，var = 1</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>范围运算符<code>succ</code> 可以返回一个：进位到下一位的值。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">1.succ     #=&gt; 2</div><div class="line">a.succ     #=&gt; b</div></pre></td></tr></table></figure>
</li>
<li><p>原来ruby本身有优先级运算符：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">1 + 2 * 3     #=&gt; 1 + (2 * 3)        #=&gt; 7</div><div class="line">2 +3 &lt; 5 + 4  #=&gt; (2 + 3) &lt; (5 + 4)  #=&gt; true</div></pre></td></tr></table></figure>
<p>还有一些没见过的运算符，刚开始还是老实用括号吧，哈哈！</p>
</li>
</ol>
<h4 id="异常处理与错误提示："><a href="#异常处理与错误提示：" class="headerlink" title="异常处理与错误提示："></a>异常处理与错误提示：</h4><ol>
<li><p>错误提示格式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">文件名：行号：in 方法名：错误信息(异常类名)</div><div class="line">      form 文件名：行号：in 方法名</div></pre></td></tr></table></figure>
<p>example: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt; ruby test.rb</div><div class="line">test.rb:2:in `initialize&apos;:No such file or directory - /no/file(Errno::ENOENT)</div><div class="line">        form test.rb:2:in `open&apos;</div><div class="line">        form test.rb:2:in `foo&apos;</div><div class="line">        form test.rb:9:in `main&apos;</div></pre></td></tr></table></figure>
</li>
<li><p>可以用这个格式来处理异常：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">begin</div><div class="line">  可能会发生异常的处理</div><div class="line">rescue =&gt; 引用异常对象的变量</div><div class="line">  发生异常时的处理</div><div class="line">  sleep(10)             #=&gt; 等待10秒</div><div class="line">  retry                 #=&gt; 再执行一次begin下的程式</div><div class="line">ensure</div><div class="line">  不管是否发生异常都希望执行的处理</div><div class="line">end</div></pre></td></tr></table></figure>
<p>这样不至于遇到错误时立即爆掉！！！</p>
</li>
<li><p>还可以：简化</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">begin</div><div class="line">  表达式 1</div><div class="line">rescue</div><div class="line">  表达式 2</div><div class="line">end</div><div class="line"></div><div class="line">#=&gt; 等同于下面这个：</div><div class="line"></div><div class="line">表达式1 rescue 表达式2</div></pre></td></tr></table></figure>
</li>
<li><p>还可以：再简化</p>
<ul>
<li>如果该方法是一整个begin ~ end 包含，可以省略<code>begin</code> <code>end</code>，可以直接用<code>rescue</code> <code>ensure</code></li>
</ul>
</li>
<li><p>还可以指定需要捕捉的异常：<br><img src="http://olmrxx9ks.bkt.clouddn.com/blog/2017-07-07-071120.jpg" alt=""></p>
</li>
<li><p><strong><u>主动抛出异常</u></strong></p>
<p><strong><u><code>raise</code></u></strong></p>
<p><img src="http://olmrxx9ks.bkt.clouddn.com/blog/2017-07-07-071615.jpg" alt=""></p>
<p>书中没有给出例子！差评！</p>
</li>
<li><p><code>sort</code>方法可以对数组进行排序：<br><img src="http://olmrxx9ks.bkt.clouddn.com/blog/2017-07-07-073344.jpg" alt=""></p>
</li>
<li><p><code>&lt;=&gt;</code>排序运算符，可以进行排序。</p>
</li>
<li><p>数组里如果要按照长度来排序，可以：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">array = [&quot;rails&quot;, &quot;ruby&quot;, &quot;fullstack&quot;]</div><div class="line">array.sort&#123; |a, b| a.length &lt;=&gt; b.length &#125;</div><div class="line">#=&gt; [&quot;ruby&quot;, &quot;rails&quot;, &quot;fullstack&quot;]</div></pre></td></tr></table></figure>
<p>解说：先利用<code>sort</code>让数组遍历两两相比较，再增加代码块！人才啊！</p>
</li>
<li><p>要想把一段文字，直接切成一个个单词然后放入数组？可以这样：</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ary = %w(This is a example, I love rails)</div><div class="line"></div><div class="line">#=&gt; [&quot;This&quot;, &quot;is&quot;, &quot;a&quot;, &quot;example,&quot;, &quot;I&quot;, &quot;love&quot;, &quot;rails&quot;]</div></pre></td></tr></table></figure>
<ol>
<li><p><code>upto</code>把值按从小到大的顺序取出，这个是Integer#upto方法！</p>
</li>
<li><p>判断使用方法时是否有带块？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">if block_given?</div></pre></td></tr></table></figure>
</li>
<li><p>在块中直接调用<code>break</code> <code>next</code>等方法控制流程，会直接返回nil，如果想返回带参数，可以使用：</p>
<ul>
<li><code>break 0</code></li>
<li><code>next 0</code></li>
</ul>
</li>
<li><p>利用<code>Proc</code>把代码块变成对象后，就可以直接用<code>cell方法</code>来直接使用啦~</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">hello = Proc.new do |new|</div><div class="line">  puts &quot;Hello, #&#123;name&#125;.&quot;</div><div class="line">end</div><div class="line"></div><div class="line">hello.call(&quot;World&quot;)          #=&gt; Hello, World.</div><div class="line">hello.call(&quot;Ruby&quot;)           #=&gt; Hello, Ruby.</div></pre></td></tr></table></figure>
</li>
<li><p>传参数的时候 ，有一种参数叫做：<code>Proc参数</code>是这样的：<code>&amp;block</code> （要放在最后一个参数）</p>
</li>
<li><p>判断是否有带block的另一个方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">if block #直接进行判断</div></pre></td></tr></table></figure>
</li>
<li><p>块变量的作用域：只在block中有效。如果跟局部变量同名，要小心赋值问题！</p>
</li>
</ol>
<p>### </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/archives/2017/08/03/2017-08-03-extracting-of-the-ruby-base-tutorial/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="黄鸿亮">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://olmrxx9ks.bkt.clouddn.com/2017-09-07-080115.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Activeliang's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/archives/2017/08/03/2017-08-03-extracting-of-the-ruby-base-tutorial/" itemprop="url">《ruby基础教程》第一部分 提取</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-03T01:22:00+08:00">
                2017-08-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>写在前面：这里的提取是个人的提取（一些本人熟知的知识点不会在这里记录）。如果你和我一样的程度（刚参加完全栈两次大赛），那这个提取能提供不少帮助。</p>
<p>开始：</p>
<ol>
<li>程序很多，各自目的不同：有的为了运行快速，有的为了一次编写，可以在从多平台使用，有的为了让小孩也能简单编程。而ruby：为了让编程更快乐！</li>
<li>什么是脚本语言：不需要经常翻译（编译），电脑能直接运行的语言。</li>
</ol>
<p>第 1 部分 Ruby 初探</p>
<ol>
<li>执行单个ruby文件xxx.rb，方法：<ul>
<li>ruby helloruby.rb</li>
</ul>
</li>
<li>直接打开irb:<ul>
<li>$irb</li>
</ul>
</li>
<li>\n是换行符。</li>
<li>\ ：转义字符。<ul>
<li>程序会对这个\后的字体做特殊的处理。<pre><code>print(&quot;hello,\&quot;ruby\&quot;.)   #=&gt; hello, &quot;ruby&quot;.
print(&quot;hello \\ ruby!&quot;)   #=&gt; hello \ ruby! 
</code></pre></li>
</ul>
</li>
<li>“”和’’，单引号和双引号的区别：<br>‘’里的东西，会原封不动地输出！（但，有两个符号除外：’ &amp; \）</li>
<li>puts和print方法的区别：<ul>
<li>puts后面默认会带有换行符。</li>
<li>print后面默认不带换行符。</li>
</ul>
</li>
<li>p方法可以做什么：（这个方法一般是程序员在用！）<ul>
<li>能从输出结果分辨字符串与数值。</li>
<li>不会转义。</li>
</ul>
</li>
<li>编码的规则称为 encoding</li>
<li>用这条指令开启irb可以开启简洁模式：<pre><code>$irb --simple-prompt
</code></pre></li>
<li><p>要用sin sqrt等方法时，可以这样：（使用Math这个类方法）</p>
<p> =&gt; irb</p>
<blockquote>
<blockquote>
<p>Math.sin(3.1415)   #=&gt; 9.26535896604902e-05 </p>
</blockquote>
</blockquote>
</li>
<li><p>注释：</p>
<ul>
<li>单行注释：以#开头的注释。</li>
<li>多行注释：<pre><code>=begin
这是一个例子
2017-7-5日
=end
</code></pre></li>
<li>还有一个作用：暂时不执行</li>
</ul>
</li>
<li>while语句：<pre><code>i = 1
while i &lt;= 10
  puts i
  i = i + 1
end
</code></pre></li>
<li>times语句：（迭代器）<pre><code>5.times do
  p &quot;example&quot;
end 
</code></pre></li>
<li>像数组、散列这样保存对象的对象,我们称为容器(container)。</li>
</ol>
<p>数组：</p>
<ol>
<li>什么是数组：    按顺序保存多个对象的对象。</li>
<li>数组的大小 ：size<pre><code>a = [1,2,3]
a.size         #=&gt; 3
</code></pre></li>
</ol>
<p>散列：</p>
<ol>
<li>散列是键值对(key-value pair)的一种数据结构。</li>
</ol>
<p>正则表达式：</p>
<ol>
<li>什么正则表达式：<pre><code>/abc/ =~ &quot;eacbcefg&quot;
</code></pre><ul>
<li>左边：模式，用/ /包起来。</li>
<li>右边：要匹配的字体串。<br>  /abc/i =~ “aAbcdefg”</li>
<li>在/后面加一个i表示忽略大小写。</li>
</ul>
</li>
</ol>
<p>从命令中拿到参数：</p>
<ol>
<li>使用ruby内置的方法：ARGV[X] 就像数组一样用。</li>
<li>什么叫库：大部分的编程语言都提供了把多个不同程序组合为一个程序的功能。像这样,被其他程序引用的程序,我们称为库(library)。</li>
<li>require “./grep”中的./表示：当前目录下。</li>
<li>pp方法和p的区别：<ul>
<li>pp可以适当地换行调整输出结果，让显示更漂亮。</li>
</ul>
</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/archives/2017/07/04/2017-07-04-asdf/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="黄鸿亮">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://olmrxx9ks.bkt.clouddn.com/2017-09-07-080115.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Activeliang's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/archives/2017/07/04/2017-07-04-asdf/" itemprop="url">读《为你自己学RUBY ON RAILS--高见龙》提取记录</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-04T16:43:00+08:00">
                2017-07-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h6 id="写在前面：这里的提取是个人提取（只记录不知道的东西）。"><a href="#写在前面：这里的提取是个人提取（只记录不知道的东西）。" class="headerlink" title="写在前面：这里的提取是个人提取（只记录不知道的东西）。"></a>写在前面：这里的提取是个人提取（只记录不知道的东西）。</h6><p>电子书地址：<a href="http://railsbook.tw/" target="_blank" rel="external">http://railsbook.tw/</a></p>
<blockquote>
<h5 id="提示：在学RUBY基础时，有时不要把它和rails混在一起思考。先有ruby才有rails，ruby不了解rails，但rails很了解ruby…"><a href="#提示：在学RUBY基础时，有时不要把它和rails混在一起思考。先有ruby才有rails，ruby不了解rails，但rails很了解ruby…" class="headerlink" title="提示：在学RUBY基础时，有时不要把它和rails混在一起思考。先有ruby才有rails，ruby不了解rails，但rails很了解ruby…."></a>提示：在学RUBY基础时，有时不要把它和rails混在一起思考。先有ruby才有rails，ruby不了解rails，但rails很了解ruby….</h5></blockquote>
<h4 id="开发工具和常用指令"><a href="#开发工具和常用指令" class="headerlink" title="开发工具和常用指令"></a>开发工具和常用指令</h4><ol>
<li><p>如果出门在外，忘了带mac，怎么写代码？？？答案是可以用三线编辑器：</p>
<ul>
<li><a href="https://c9.io/" target="_blank" rel="external">https://c9.io/</a></li>
<li><a href="http://tryruby.org/levels/1/challenges/0" target="_blank" rel="external">http://tryruby.org/levels/1/challenges/0</a></li>
<li><a href="https://codeanywhere.com/" target="_blank" rel="external">https://codeanywhere.com/</a></li>
</ul>
<p>后两款：自带开发环境！！！！</p>
</li>
<li><p>常用指令：</p>
<ul>
<li><code>sudo</code> 暂时取得权限</li>
</ul>
</li>
</ol>
<h4 id="第一个应用程式"><a href="#第一个应用程式" class="headerlink" title="第一个应用程式"></a>第一个应用程式</h4><ol>
<li><p><code>scaffold</code>的作用：自动完成增删改查的功能，包括MVC。</p>
</li>
<li><p>在新增migration时，数据类型string可以省略（因为是默认）。</p>
</li>
<li><p>N+1查询问题，就是会额外查询关联的资料库，对系统资源很浪费）。解法：</p>
<ul>
<li><p>用<code>includes</code>来减少不必要的资料库查询。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">def index</div><div class="line">  @posts = Post.all</div><div class="line">end</div></pre></td></tr></table></figure>
<p>改成：(里是关联了user)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">def index</div><div class="line">  @posts = Post.includes(:user)</div><div class="line">end</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<h4 id="變數、常數、流程控制、迴圈"><a href="#變數、常數、流程控制、迴圈" class="headerlink" title="變數、常數、流程控制、迴圈"></a>變數、常數、流程控制、迴圈</h4><ol>
<li><p>如果想交换x,y两个变数的值，怎么写最ruby???</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">x, y = y, x</div></pre></td></tr></table></figure>
</li>
<li><p><code>if</code>可以放到程式的后面（这样读起来更像英文文章）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">a=1 if b &gt; a #如果b &gt; a，那么a = 1</div></pre></td></tr></table></figure>
</li>
<li><p>三元连算子：（if ….. else …..这个语法放到同一行）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">if a &gt; b </div><div class="line">  a = 1</div><div class="line">else</div><div class="line">  a = 2</div><div class="line">end</div><div class="line"></div><div class="line">#上面的程式码，可以压缩成一行：</div><div class="line">a &gt; b ? a = 1 : a = 2</div><div class="line"></div><div class="line">#帅到掉渣，有木有！</div></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="數字、字串、陣列、雜湊、符號"><a href="#數字、字串、陣列、雜湊、符號" class="headerlink" title="數字、字串、陣列、雜湊、符號"></a>數字、字串、陣列、雜湊、符號</h4><ol>
<li>注意<code>=</code> <code>==</code>的问题。一个是赋值，一个是比较！</li>
<li>整数的除法，其中一个数为小数，结果才为小数。</li>
<li>取余数<code>%</code> <ul>
<li>判断是否为单数：<code>.odd?</code></li>
<li>判断是否为复数： <code>.even?</code></li>
</ul>
</li>
<li>四舍五入<code>.round(x)</code></li>
<li>字串中要插入变量，可以用<code>#{}</code>！！！</li>
<li>字串可以直接当成数组来用，取字。</li>
<li>如何获得字串的长度：<ul>
<li>长度： <code>.size</code></li>
<li>字节： <code>.bytesize</code></li>
</ul>
</li>
<li>计算几个字几个单词： <code>.sqlite.count</code></li>
<li>大小写转换：<ul>
<li>转大写： <code>upcase</code></li>
<li>转小写： <code>downcase</code></li>
</ul>
</li>
<li>对比首尾字母：<ul>
<li>start_with?</li>
<li>end_with?</li>
</ul>
</li>
<li>替换掉其中的片段：<ul>
<li>只换第一个： <code>sub</code></li>
</ul>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">- 全部换掉：`gsub`</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">​</div></pre></td></tr></table></figure>
<p>  puts “PHP is good, and I love PHP”.sub(/PHP/, “Ruby”)</p>
<h1 id="sub-只會換掉最先遇到的那個字串"><a href="#sub-只會換掉最先遇到的那個字串" class="headerlink" title="sub 只會換掉最先遇到的那個字串"></a>sub 只會換掉最先遇到的那個字串</h1><h1 id="gt-印出「Ruby-is-good-and-I-love-PHP」"><a href="#gt-印出「Ruby-is-good-and-I-love-PHP」" class="headerlink" title="=&gt; 印出「Ruby is good, and I love PHP」"></a>=&gt; 印出「Ruby is good, and I love PHP」</h1><p>  puts “PHP is good, and I love PHP”.gsub(/PHP/, “Ruby”)</p>
<h1 id="gsub-會換掉全部符合的字串"><a href="#gsub-會換掉全部符合的字串" class="headerlink" title="gsub 會換掉全部符合的字串"></a>gsub 會換掉全部符合的字串</h1><h1 id="gt-印出「Ruby-is-good-and-I-love-Ruby」"><a href="#gt-印出「Ruby-is-good-and-I-love-Ruby」" class="headerlink" title="=&gt; 印出「Ruby is good, and I love Ruby」"></a>=&gt; 印出「Ruby is good, and I love Ruby」</h1><p>​<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">```</div><div class="line"></div><div class="line">1. `map`方法示例：</div></pre></td></tr></table></figure></p>
<pre><code>list = [1, 2, 3, 4, 5]
p list.map { |i| i * 2 - 1 }    # [1, 3, 5, 7, 9]
</code></pre>   <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">2. `reduce`方法示例：（只作数值与index的运算）</div></pre></td></tr></table></figure>
<pre><code>puts [*1..100].reduce(:+)
</code></pre>   <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">3. `select`方法示例：（相当于一个过滤器）</div></pre></td></tr></table></figure>
<pre><code>p [*1..100].select(&amp;:odd?)
</code></pre>   <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">4. 取随机数的方法：</div><div class="line"></div><div class="line">   - `shuffle`洗牌：</div></pre></td></tr></table></figure>
<pre><code>puts [*1..52].shuffle.first(5)
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">- `sample`不重复的乱数：</div></pre></td></tr></table></figure>

puts [*1..100].sample(5)
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">5. `object_id`可以检测是否同一物件。</div><div class="line"></div><div class="line">6. 什么是`symbol`：*&lt;u&gt;一个带有名字的物件&lt;/u&gt;*（其他物件都没有名字，只有它有）</div><div class="line"></div><div class="line">7. `string`与`symbol`的对比：</div><div class="line"></div><div class="line">   - string可以被改变，symbol不行</div><div class="line">   - symbol可以直接从内存中取得相同的东西，不会像string总是新建物件，所以一定程度上symbol是比较省内存的。</div><div class="line">   - symbol的比较会比string快！</div><div class="line">   - string和symbol是可以相互转换的！</div><div class="line"></div><div class="line">#### 方法與程式碼區塊（block）</div><div class="line"></div><div class="line">1. 在 Ruby 執行方法，經常省略小括號，目的是為了讓程式碼看起來更不像程式碼，反而像是一般的文章。</div><div class="line"></div><div class="line">2. 定义方法时，可以加个预设值：</div></pre></td></tr></table></figure>

def say_something(message = &quot;something&quot;)
  &quot;message: #{message}&quot;
end

p say_something &quot;hi&quot;     # =&gt; message: hi
p say_something          # =&gt; message: something
</code></pre>   <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">3. ruby很爱省略小括号和大括号，这里日后可能会掉坑~</div><div class="line"></div><div class="line">4. 什么是**程式码区块**？</div><div class="line"></div><div class="line">   &gt; `&#123; ... &#125;` 以及 `do ... end`，在 Ruby 稱之一個程式碼區塊（Block）</div><div class="line"></div><div class="line">5. 程式码区块不是：</div><div class="line"></div><div class="line">   - 不是物件：无法单独存在</div><div class="line"></div><div class="line">   - 不是参数：无法当参数，放在方法后一般不会执行。要如何才能执行：</div></pre></td></tr></table></figure>
<pre><code>  def say_hello
    puts &quot;開始&quot;
    yield          # 把控制權暫時讓給 Block
    puts &quot;結束&quot;
  end

  say_hello {
    puts &quot;這裡是 Block&quot;
  }
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">6666，原来这两个地方都可以传参数……：</div></pre></td></tr></table></figure>

  def say_hello
    puts &quot;開始&quot;
    yield 123         # 把控制權暫時讓給 Block，並且傳數字 123 給 Block
    puts &quot;結束&quot;
  end

  say_hello { |x|     # 這個 x 是來自 yield 方法
    puts &quot;這裡是 Block，我收到了 #{x}&quot;
  }
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">6. &lt;u&gt;**block的物件化：**&lt;/u&gt;</div></pre></td></tr></table></figure>

say_hello_to = Proc.new { |name| puts &quot;你好，#{name}&quot;}
say_hello_to.call(&quot;尼特羅會長&quot;)

say_hello_to.call(&quot;尼特羅會長&quot;)    # 使用 call 方法
say_hello_to.(&quot;尼特羅會長&quot;)        # 使用小括號（注意，有多一個小數點）
say_hello_to[&quot;尼特羅會長&quot;]         # 使用中括號
say_hello_to === &quot;尼特羅會長&quot;      # 使用三個等號
say_hello_to.yield &quot;尼特羅會長&quot;    # 使用 yield 方法
</code></pre>   <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">#### 類別（Class）與模組（Module）</div><div class="line"></div><div class="line">##### 类别</div><div class="line"></div><div class="line">1. 什么类别：</div><div class="line"></div><div class="line">   &gt; ##### 物件（object） = 狀態（state） + 行為（behavior）</div><div class="line"></div><div class="line">   ***一个精妙的类比：***</div><div class="line"></div><div class="line">   不知道大家有沒有在夜市有看過或吃過雞蛋糕，有小貓、小狗等可愛動物造型，只要把調配好的麵粉糊倒進模具，蓋上蓋子，幾分鐘後就會有香噴噴又造型可愛的雞蛋糕可以吃了。</div><div class="line"></div><div class="line">   ![image](http://railsbook.tw/images/chapter08/cake_maker.jpg)photo by [Bryan Liu](https://www.flickr.com/photos/bryanliu99/)</div><div class="line"></div><div class="line">   那個烤盤模具，就是類別（Class）的概念。如果沒意外，一樣形狀的模具，放一樣的原料進去，做出來雞蛋糕的型狀應該都會長得一樣。而這個做出來的雞蛋糕，以物件導向程式設計的概念來說便稱之「實體（Instance）」。</div><div class="line"></div><div class="line">2. 传参数初始化：</div></pre></td></tr></table></figure>
<pre><code>class Cat
  def initialize(name, gender)
    @name = name
    @gender = gender
  end

  def say_hello
    puts &quot;hello, my name is #{@name}&quot;
  end
end

kitty = Cat.new(&quot;kitty&quot;, &quot;female&quot;)
kitty.say_hello    # =&gt; hello, my name is kitty
</code></pre>   <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">3. `attr_accessor`的作用：</div><div class="line"></div><div class="line">   帮助设定和取用实体变数的值！（ruby没有【属性】一说！）</div><div class="line"></div><div class="line">   所以，以下这个：</div></pre></td></tr></table></figure>
<pre><code>class Cat
  def initialize(name, gender)
    @name = name
    @gender = gender
  end

  def say_hello
    puts &quot;hello, my name is #{@name}&quot;
  end

  def name
    @name
  end

  def name=(new_name)
    @name = new_name
  end
end

kitty = Cat.new(&quot;kitty&quot;, &quot;female&quot;)
kitty.name = &quot;nancy&quot;
puts kitty.name        # =&gt; nancy
</code></pre>   <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">可以直接变成：</div></pre></td></tr></table></figure>
<pre><code>class Cat
  attr_accessor :name

  def initialize(name, gender)
    @name = name
    @gender = gender
  end

  def say_hello
    puts &quot;hello, my name is #{@name}&quot;
  end
end
</code></pre>   <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">   有了这个设定后，我们就可以直接用这个参数，像属性一样方便用！！！</div><div class="line"></div><div class="line">4. 什么实体方法，什么是类别方法：</div><div class="line"></div><div class="line">   - 作用在实体上的方法，叫做：实体方法。</div><div class="line"></div><div class="line">   - 作用在类别上的方法，叫做：类别方法。这个有几种表现：</div><div class="line"></div><div class="line">     -</div></pre></td></tr></table></figure>
<pre><code>  class Cat
    def self.all
      # ...
    end
  end
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure>

- <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">class Cat</div><div class="line">  class &lt;&lt; self</div><div class="line">    def all</div><div class="line">      # ...</div><div class="line">    end</div><div class="line">  end</div><div class="line">end</div></pre></td></tr></table></figure>

  有很多类别方法时，可以用这种！
</code></pre><ol>
<li><p>继承：可以让代码更简洁</p>
</li>
<li><p><strong>open class</strong>: 可以方便地为方法“加料”！</p>
</li>
<li><p>如果想要分开定义一些方法，可以用到<strong><em>模组</em></strong>，方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">module Flyable</div><div class="line">  def fly</div><div class="line">    puts &quot;I can fly!&quot;</div><div class="line">  end</div><div class="line">end</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">class Dog</div><div class="line">  include Flyable</div><div class="line">end</div></pre></td></tr></table></figure>
</li>
<li><p>模组和类别的不同之处：</p>
<ul>
<li>模组没办法<code>new</code>一个新的实体出来。</li>
<li>模组没办法继承别的模组。</li>
</ul>
</li>
<li><p>定义外部键时，使用<code>references</code>来自动增加外部键：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rails g model post user:references</div></pre></td></tr></table></figure>
<p>这样，<code>references</code>会做多两件事：</p>
<ol>
<li>自动加上索引，加快查询速度。</li>
<li>自动帮model加入关联。</li>
</ol>
</li>
</ol>
<h4 id="Layout，Render-與-View-Helper"><a href="#Layout，Render-與-View-Helper" class="headerlink" title="Layout，Render 與 View Helper"></a>Layout，Render 與 View Helper</h4><ol>
<li><p>在特定的controller 的action里，如何你想用不同的layout可以这样：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">class CandidatesController &lt; ApplicationController</div><div class="line"></div><div class="line">  def index</div><div class="line">    @candidates = Candidate.all</div><div class="line">    render layout: &quot;backend&quot;</div><div class="line">  end</div><div class="line"></div><div class="line">  # ...[略]...</div><div class="line">end</div></pre></td></tr></table></figure>
</li>
<li><p>如果想给每个页面定义网页title，这个好！可以这样做：</p>
<ul>
<li>方法1：使用 provide：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&lt;!DOCTYPE html&gt;</div><div class="line">&lt;html&gt;</div><div class="line">  &lt;head&gt;</div><div class="line">    &lt;title&gt;&lt;%= yield :my_title %&gt;&lt;/title&gt;</div><div class="line">    &lt;%= csrf_meta_tags %&gt;</div><div class="line">    &lt;%= stylesheet_link_tag &apos;application&apos;, media: &apos;all&apos;, &apos;data-turbolinks-track&apos;: &apos;reload&apos; %&gt;</div><div class="line">    &lt;%= javascript_include_tag &apos;application&apos;, &apos;data-turbolinks-track&apos;: &apos;reload&apos; %&gt;</div><div class="line">  &lt;/head&gt;</div><div class="line"></div><div class="line">  &lt;body&gt;</div><div class="line">    &lt;div class=&quot;container&quot;&gt;</div><div class="line">    &lt;%= yield %&gt;</div><div class="line">    &lt;/div&gt;</div><div class="line">  &lt;/body&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&lt;% provide :my_title, &quot;你好，我是 Title&quot; %&gt;</div><div class="line"></div><div class="line">&lt;h1&gt;候選人列表&lt;/h1&gt;</div><div class="line"></div><div class="line">&lt;%= link_to &quot;新增候選人&quot;, new_candidate_path %&gt;</div><div class="line"></div><div class="line">&lt;table class=&quot;table&quot;&gt;</div><div class="line">  &lt;thead&gt;</div><div class="line">    &lt;tr&gt;</div><div class="line">      &lt;td&gt;投票&lt;/td&gt;</div><div class="line">      &lt;td&gt;候選人姓名&lt;/td&gt;</div><div class="line">...[略]...</div></pre></td></tr></table></figure>
<ul>
<li>使用 content_for：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&lt;% content_for :my_title do %&gt;</div><div class="line">你好，我是 Title</div><div class="line">&lt;% end %&gt;</div><div class="line"></div><div class="line">&lt;h1&gt;候選人列表&lt;/h1&gt;</div><div class="line"></div><div class="line">&lt;%= link_to &quot;新增候選人&quot;, new_candidate_path %&gt;</div><div class="line"></div><div class="line">&lt;table class=&quot;table&quot;&gt;</div><div class="line">  &lt;thead&gt;</div><div class="line">    &lt;tr&gt;</div><div class="line">      &lt;td&gt;投票&lt;/td&gt;</div><div class="line">      &lt;td&gt;候選人姓名&lt;/td&gt;</div><div class="line">...[略]...</div></pre></td></tr></table></figure>
</li>
<li><p>更好地用<code>render</code>:</p>
<ul>
<li>partial里尽量用区域变量。</li>
<li>使用时再传递这个变量。</li>
</ul>
<p>例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;div class=&quot;advertisement&quot;&gt;</div><div class="line">  &lt;div&gt;廣告&lt;/div&gt;</div><div class="line">  &lt;div&gt; &lt;%= content %&gt; &lt;/div&gt;</div><div class="line">&lt;/div&gt;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;%= render &quot;banner&quot;, content: &quot;我是廣告的內容&quot; %&gt;</div></pre></td></tr></table></figure>
<ul>
<li>partial里有一个<code>collection</code>的方法，使用时传递这个参数，就可以迭代输出partial。（回圈效果）</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;%= render partial: &quot;candidate&quot;, collection: @candidates %&gt;</div></pre></td></tr></table></figure>
<p>这里还可以简化成：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;%= render @candidates %&gt;</div></pre></td></tr></table></figure>
<p>但要满足以下条件：（利用了rails的惯例）</p>
<ul>
<li><code>_xxx.html.erb</code>的名字必须是这包资料的<strong><u>单数</u></strong> </li>
<li>位置必须放在同一目录下。</li>
<li><code>_xxx.html.erb</code>里不要写回圈，里面的区域变数必须是单数。</li>
</ul>
</li>
<li><p>善用<code>View Helper</code> !</p>
</li>
</ol>
<h4 id="Model-基本操作"><a href="#Model-基本操作" class="headerlink" title="Model 基本操作"></a>Model 基本操作</h4><ol>
<li><p>当我们需要引用外部数据库时，假如我们想改名字，可以这样做：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">class User &lt; ActiveRecord::Base</div><div class="line">  self.table_name = &quot;example&quot;</div><div class="line">end</div></pre></td></tr></table></figure>
</li>
<li><p>什么是<code>主键</code>（primary key）：每個資料表的流水編號欄位（ID）.</p>
<p>当然这个主键也可以<strong>自定义</strong>：</p>
<ul>
<li><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">class User &lt; ActiveRecord::Base</div><div class="line">  self.primary_key = &quot;user_id&quot;</div><div class="line">end</div></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure>
</li>
<li><p>什么是ORM?</p>
<blockquote>
<p>我們如果想要存取資料庫裡的內容，以前必需透過資料庫查詢語言(SQL)向資料庫進行查詢，但透過 ORM 的包裝之後，可以讓我們用操作「物件」的方式來操作資料庫。</p>
</blockquote>
</li>
<li><p><code>平均数</code>， <code>求和</code>， <code>最大值</code>，<code>最小值</code> 直接让数据库来计算！</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">$ bin/rails console</div><div class="line">&gt;&gt; Candidate.sum(:age)</div><div class="line">   (0.2ms)  SELECT SUM(&quot;candidates&quot;.&quot;age&quot;) FROM &quot;candidates&quot;</div><div class="line">=&gt; 44</div><div class="line"></div><div class="line">&gt;&gt; Candidate.average(:age).to_f</div><div class="line">   (0.1ms)  SELECT AVG(&quot;candidates&quot;.&quot;age&quot;) FROM &quot;candidates&quot;</div><div class="line">=&gt; 14.6666666666667</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$ bin/rails console</div><div class="line">&gt;&gt; Candidate.maximum(:age)</div><div class="line">   (0.2ms)  SELECT MAX(&quot;candidates&quot;.&quot;age&quot;) FROM &quot;candidates&quot;</div><div class="line">=&gt; 22</div><div class="line">&gt;&gt; Candidate.minimum(:age)</div><div class="line">   (0.2ms)  SELECT MIN(&quot;candidates&quot;.&quot;age&quot;) FROM &quot;candidates&quot;</div><div class="line">=&gt; 2</div></pre></td></tr></table></figure>
</li>
<li><p>更新数据的方法有 <code>save</code>、<code>update</code>、<code>update_attribute</code> 及 <code>update_attributes</code>：</p>
<ul>
<li><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"># 使用 save 方法</div><div class="line">candidate.name = &quot;剪彩倫&quot;</div><div class="line">candidate.save</div><div class="line"></div><div class="line"># 使用 update_attribute 方法更新單一欄位的值（注意：方法名字是單數）</div><div class="line">candidate.update_attribute(:name, &quot;剪彩倫&quot;)</div><div class="line"></div><div class="line"># 使用 update 更新資料，可一次更新多個欄位，且不需要再呼叫 save 方法</div><div class="line">candidate.update(name: &quot;剪彩倫&quot;, age: 20)</div><div class="line"></div><div class="line"># 使用 update_attributes 方法</div><div class="line">candidate.update_attributes(name: &quot;剪彩倫&quot;, age: 20)</div></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">  單數的 `update_attribute` 方法會跳過驗證（Validation），等於是 `save(validate: false)` 的效果，在使用的時候要稍微注意一下。</div><div class="line"></div><div class="line">- 如果想整个资料表一起修改：</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Candidate.update_all(name: &quot;剪彩倫&quot;, age: 18)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure>
</li>
<li><p>scope可以嵌套，利用嵌套，可以方便我们：</p>
<ul>
<li>使代码整洁。</li>
<li>方便我们修改。</li>
</ul>
<p>还可以：预设scope,  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">class Product &lt; ActiveRecord::Base</div><div class="line">  default_scope &#123; order(&apos;id DESC&apos;) &#125;</div><div class="line">  scope :available, -&gt; &#123; where(is_available: true) &#125;</div><div class="line">end</div></pre></td></tr></table></figure>
<p>要取消預設的 scope，必須使用 <code>unscope</code> 方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">$ bin/rails console</div><div class="line">&gt;&gt; Product.unscope(:order)</div><div class="line">  Product Load (0.2ms)  SELECT &quot;products&quot;.* FROM &quot;products&quot;</div><div class="line"></div><div class="line">&gt;&gt; Product.unscope(:order).order(:title)</div><div class="line">  Product Load (0.3ms)  SELECT &quot;products&quot;.* FROM &quot;products&quot; ORDER BY &quot;products&quot;.&quot;title&quot; ASC</div></pre></td></tr></table></figure>
<p>這樣才能把預設的 scope 的效果移除。</p>
</li>
</ol>
<h4 id="Model-Migration"><a href="#Model-Migration" class="headerlink" title="Model Migration"></a>Model Migration</h4><ol>
<li><p>什么是migration: 描述数据表长什么样的档案。</p>
</li>
<li><p>为什么要这样设计：一切为了方便多人协作！</p>
</li>
<li><p>刚执行<code>rake db:migrate</code>发现要改一下栏位，怎么办？</p>
<ul>
<li>可以用<code>rollback</code> : <code>rake db:rollback</code> (这样一次可以退回一个migration文件。）</li>
<li>新增migration文件来修改。（推荐！）</li>
</ul>
</li>
<li><p>新增migration文件时，原来可以直接上index索引啊，酷！：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ bin/rails g migration add_candidate_id_to_articles candidate_id:integer:index</div><div class="line">Running via Spring preloader in process 7765</div><div class="line">  invoke  active_record</div><div class="line">  create    db/migrate/20170101081538_add_candidate_id_to_articles.rb</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">class AddCandidateIdToArticles &lt; ActiveRecord::Migration[5.0]</div><div class="line">  def change</div><div class="line">    add_column :articles, :candidate_id, :integer</div><div class="line">    add_index :articles, :candidate_id</div><div class="line">  end</div><div class="line">end</div></pre></td></tr></table></figure>
</li>
<li><p><code>rake db:setup</code>可以一口氣把資料表建完，順便把預設資料寫入。</p>
</li>
</ol>
<h4 id="model的关联性"><a href="#model的关联性" class="headerlink" title="model的关联性"></a>model的关联性</h4><ol>
<li><p>什么是外部键：用于对应其他model主键的栏位，例如：<code>user_id</code> <code>product_id</code></p>
</li>
<li><p>可以用<code>user.create_post(:title =&gt; &quot;hello&quot;)</code>来新建对应的资料，生成的资料自动对应好user_id。</p>
</li>
<li><p>之前商店大赛加油站，无法先新建address再对应user_id，现在终于找到原因和解决方法！：</p>
<ul>
<li><p>原因：rails5之后，必须先建立<strong><u><code>头</code></u></strong>才能建立<strong><code>尾</code></strong>！</p>
</li>
<li><p>解法：加多一个<code>optional: true</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">class Store &lt; ApplicationRecord</div><div class="line">  belongs_to :user, optional: true</div><div class="line">end</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>has_one 跟 belongs_to 方法需要同時設定嗎？</p>
<p>不一定，端看需求，一樣以我們上面 User 跟 Store 的例子來看，如果你不需要「從 Store 反查 User」的功能的話，那 <code>belongs_to</code> 是不需要設定的。</p>
</li>
<li><p>其实多对多没有我们rails101教材上的那么复杂，其实可以这么简单：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">class WareHouse &lt; ApplicationRecord</div><div class="line">  belongs_to :store</div><div class="line">  belongs_to :product</div><div class="line">end</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">class Store &lt; ApplicationRecord</div><div class="line">  belongs_to :user</div><div class="line"></div><div class="line">  has_many :ware_houses</div><div class="line">  has_many :products, through: :ware_houses</div><div class="line">end</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">class Product &lt; ApplicationRecord</div><div class="line">  has_many :ware_houses</div><div class="line">  has_many :stores, through: :ware_houses</div><div class="line">end</div></pre></td></tr></table></figure>
<p>看到没有，第二个has_many只要写两个字段就可以啦！之前是这样的：</p>
<p><img src="http://olmrxx9ks.bkt.clouddn.com/blog/2017-07-03-Snip20170703_9.png" alt=""></p>
<p>有点让新手摸不着头脑。。。</p>
</li>
<li><p>酷！还有一种叫HABTM（has_and_belongs_to_many）!</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"># Store Model</div><div class="line">class Store &lt; ActiveRecord::Base</div><div class="line">  has_and_belongs_to_many :products</div><div class="line">end</div><div class="line"></div><div class="line"># Product Model</div><div class="line">class Product &lt; ActiveRecord::Base</div><div class="line">  has_and_belongs_to_many :stores</div><div class="line">end</div></pre></td></tr></table></figure>
<p>就這樣，不需要另外新增第三方 Model 即可完成多對多關連。注意，我是說「不需要第三方 Model」，不是「不需要第三方資料表」，畢竟還是要有一個資料表存放雙方的資訊，只是這個資料表因為不重要也不會存取它，所以可以不需要 Model 對應。</p>
<p>這個第三方資料表的名字是有規定的，預設是「兩個資料表依照英文字母先後順序排序，中間以底線分格」，所以以我們這個例子來說，這個資料表的名字就是「products_stores」。</p>
</li>
</ol>
<h4 id="Model-驗證及回呼"><a href="#Model-驗證及回呼" class="headerlink" title="Model 驗證及回呼"></a>Model 驗證及回呼</h4><ol>
<li><p>资料验证：有三个方法：</p>
<ul>
<li>前端驗證：在 HTML 頁面使用 JavaScript 在使用者填寫資料的時候就先檢查。</li>
<li>後端驗證：資料傳進來在寫入資料庫之前之後再檢查。</li>
<li>資料庫驗證：直接由資料庫本身所提供的功能來做資料驗證。</li>
</ul>
<p>推荐model层来做这件事！</p>
</li>
<li><p>验证是否为空：</p>
<ul>
<li><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">class Article &lt; ApplicationRecord</div><div class="line">  validates :title, presence: true</div><div class="line">end</div></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">-</div></pre></td></tr></table></figure>
<pre><code>class Article &lt; ActiveRecord::Base
  validates_presence_of :title
end
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">     这两种效果是一样的。</div><div class="line"></div><div class="line">3. 想查看错误的提示信息？</div><div class="line"></div><div class="line">   - 检查是否有错误提示：`a1.errors.any?`</div><div class="line">   - 检查错误提示是什么：`a1.errors.full_messages`</div><div class="line"></div><div class="line">4. 只有这些方法会触发验证： </div><div class="line"></div><div class="line">   - create</div><div class="line">   - create!</div><div class="line">   - save</div><div class="line">   - save!</div><div class="line">   - update</div><div class="line">   - update!</div><div class="line"></div><div class="line">   其它方法不會經過驗證流程喔</div><div class="line"></div><div class="line">   &gt; 有驚嘆號版本的，如果驗證未通過會產生錯誤訊息，而沒有驚嘆號版本則僅會回傳該 Model 的一個空物件。这大概就是惊叹号的好处了！</div><div class="line"></div><div class="line">5. 如何跳过验证？</div></pre></td></tr></table></figure>
<p>  user1 = User.new<br>  user1.save(validate: false)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">6. 检查是否能通过验证？</div></pre></td></tr></table></figure>
<blockquote>
<blockquote>
<p>user1.valid?<br>=&gt; false</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">7. 回呼（Callback）：</div><div class="line"></div><div class="line">   ![](http://olmrxx9ks.bkt.clouddn.com/blog/2017-07-03-060507.jpg)其中，顏色比較深的那幾個流程是有機會可以掛上一些方法，又稱之回呼（Callback）</div><div class="line"></div><div class="line">   &gt; 注意：`before_save` 跟 `before_create` 的差別，在於 `before_save` 是每次存檔的時候都會經過，但 `before_create` 只有在「新增」的時候才會觸發。</div><div class="line"></div><div class="line">   除了這樣的寫法，如果內容單純的話，也是可以使用 Block 的方式來寫：</div></pre></td></tr></table></figure>
</blockquote>
</blockquote>
<p>  require ‘digest’<br>  class User &lt; ActiveRecord::Base</p>
<pre><code>before_create do
  self.email = Digest::MD5.hexdigest(email)
end
</code></pre><p>  end</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">#### 寄發信件</div><div class="line"></div><div class="line">1. 之前的奇怪，现在不奇怪了，寄送信件，rails已内置好这个功能了，使用很容易！</div><div class="line"></div><div class="line">#### 背景工作及工作排程（异步任务）</div><div class="line"></div><div class="line">&gt; 慌然大悟，原来这就是我之前一直想学的异步任务！！！！相见恨晚！</div><div class="line"></div><div class="line">如果我要写一个异步任务，可以这样做：</div><div class="line"></div><div class="line">1. 执行`rails g job user_confirm_email`</div><div class="line"></div><div class="line">2. 设置   *&lt;u&gt;app/jobs&lt;/u&gt;* :</div></pre></td></tr></table></figure>
<p>  class UserConfirmEmailJob &lt; ApplicationJob</p>
<pre><code>queue_as :default

def perform(user)
  # 在這裡寄發確認信...
end
</code></pre><p>  end</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">3. 在controller里作用：</div></pre></td></tr></table></figure>
<pre><code>def create
  @user = User.new(user_params)
  if @user.save
    UserConfirmEmailJob.perform_later(@user)
    redirect_to @user, notice: &apos;User was successfully created.&apos;
  else
    render :new
  end
end
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">##### 搞定！</div><div class="line"></div><div class="line">一些小技巧：</div><div class="line"></div><div class="line">- 其中，`queue_as` 方法是指這件工作急不急，預設值是 `:default`，如果這件工作不急，可把 `:default` 改成 `:low_priority`，如果是急件則可設定成 `:urgent`。</div><div class="line"></div><div class="line">-</div></pre></td></tr></table></figure>
<h1 id="這樣是-5-秒之後做"><a href="#這樣是-5-秒之後做" class="headerlink" title="這樣是 5 秒之後做"></a>這樣是 5 秒之後做</h1><p> UserConfirmEmailJob.set(wait: 5.seconds).perform_later(@user)</p>
<h1 id="這樣是「明天下午有空再做」"><a href="#這樣是「明天下午有空再做」" class="headerlink" title="這樣是「明天下午有空再做」"></a>這樣是「明天下午有空再做」</h1><p> UserConfirmEmailJob.set(wait_until: Date.tomorrow.noon).perform_later(@user)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">- 通常异步任务会被放在缓存中，如果宕机，重开机这些资料会不见。安全起见，可以用第三方gem:（把任务放入资料库）常用：有 `Sidekiq` 跟 `Delayed Job`</div><div class="line"></div><div class="line">  下面以`Delayed Job`为例：</div><div class="line"></div><div class="line">  - 在 *&lt;u&gt;Gemfile.rb&lt;/u&gt;* 中增加：</div></pre></td></tr></table></figure>
<p>   gem ‘delayed_job_active_record’</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">-</div></pre></td></tr></table></figure>
<p> $bundle</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">  - 修改：`app/configs/application.rb`：</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">#### API 模式</div><div class="line"></div><div class="line">1. 直接用`render json: @users`会输出所有的json数据。如果想过滤一些数据的话，可以这样：</div><div class="line"></div><div class="line">   - 新增`app/views/users/index.json.jbuilder`:</div></pre></td></tr></table></figure>
<pre><code>json.array! @users, partial: &apos;users/user&apos;, as: :user
</code></pre>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">- 新增`app/views/users/_user.json.jbuilder`:</div></pre></td></tr></table></figure>
<pre><code>json.extract! user, :id, :name, :email, :created_at, :updated_at
json.url user_url(user, format: :json)
</code></pre>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">2. 有一个叫**&lt;u&gt;API-Only&lt;/u&gt;** 的东西，在新增专案时，选择这种模式，可以帮rails减肥！</div></pre></td></tr></table></figure>
<p>$ rails new my_blog –api</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">#### 寫測試讓你更有信心 Part 1</div><div class="line"></div><div class="line">1. 为什么要写测试：</div><div class="line"></div><div class="line">   &gt; 前期看起来有点花功能 ，但却是为后面多次开发的测试节省时间！</div><div class="line"></div><div class="line">   不写测试可能还有各种偷懒的理由，但，跟着大神学着写吧~</div><div class="line"></div><div class="line">   &gt; 不要為了測試而測試，你寫的是「規格」（Spec）</div><div class="line"></div><div class="line">2. 开发前写一写“测试“，这里作者说是`规格`。</div><div class="line"></div><div class="line">###### 下面以RSpec来实作：</div><div class="line"></div><div class="line">1. 安装RSpec:</div></pre></td></tr></table></figure>
<p>$ gem install rspec</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">2. 把要有哪些项目要测试，先写出来：</div></pre></td></tr></table></figure>
<h1 id="檔案：bank-account-spec-rb"><a href="#檔案：bank-account-spec-rb" class="headerlink" title="檔案：bank_account_spec.rb"></a>檔案：bank_account_spec.rb</h1><p>  RSpec.describe BankAccount do</p>
<pre><code>describe &quot;存錢功能&quot; do
  it &quot;原本帳戶有 10 元，存入 5 元之後，帳戶餘額變 15 元&quot; do
  end

  it &quot;原本帳戶有 10 元，存入 -5 元之後，帳戶餘額還是 10 元（不能存入小於等於零的金額）&quot; do
  end
end

describe &quot;領錢功能&quot; do
  it &quot;原本帳戶有 10 元，領出 5 元之後，帳戶餘額變 5 元&quot; do
  end

  it &quot;原本帳戶有 10 元，試圖領出 20 元，帳戶餘額還是 10 元，但無法領出（餘額不足）&quot; do
  end

  it &quot;原本帳戶有 10 元，領出 -5 元之後，帳戶餘額還是 10 元（不能領出小於或等於零的金額）&quot; do
  end
end
</code></pre><p>  end<br>```</p>
<p>然后开始写内容：</p>
<p><img src="http://olmrxx9ks.bkt.clouddn.com/blog/2017-07-04-Snip20170704_17.png" alt=""></p>
</li>
<li><p>然后，开始<code>$ rspec bank_account_spec.rb</code>进行测试，自然会出错。</p>
</li>
<li><p>根据错误提示，把所有bug都解掉！</p>
</li>
<li><p>一些小技巧：</p>
<ul>
<li>before(:each)</li>
<li>before(:all)</li>
<li><code>let(:account){BankAccount.new(10)}</code>这个语句相当于动态地为整个方法提供一个区块变数。</li>
</ul>
</li>
<li><p>寫測試是算是業界很常見的標準技能，所以：写吧！</p>
</li>
</ol>
<h4 id="代码重构："><a href="#代码重构：" class="headerlink" title="代码重构："></a>代码重构：</h4><ol>
<li>页面上的逻辑可以这样处理：<ul>
<li>写进viewhelper</li>
<li>在model里写义一个实体方法，然后在页面就只可以直接用啦！</li>
</ul>
</li>
<li>善用继承，不能继承的就引入模组功能。</li>
</ol>
<h4 id="代码重构（进阶版）："><a href="#代码重构（进阶版）：" class="headerlink" title="代码重构（进阶版）："></a>代码重构（进阶版）：</h4><ol>
<li><h6 id="設計-Service-Object-類別，新增纯ruby的类别。"><a href="#設計-Service-Object-類別，新增纯ruby的类别。" class="headerlink" title="設計 Service Object 類別，新增纯ruby的类别。"></a>設計 Service Object 類別，新增纯ruby的类别。</h6></li>
<li><h6 id="使用-Form-Object"><a href="#使用-Form-Object" class="headerlink" title="使用 Form Object"></a>使用 Form Object</h6></li>
</ol>
<blockquote>
<p>表示暂时看不太懂。。。先放过。。</p>
</blockquote>
<p>后面的内容实操一遍，基本没有什么重要的知识了……。。</p>
<blockquote>
<p>当然这个课程还有一些不错的内容在更新中……</p>
<p><img src="http://olmrxx9ks.bkt.clouddn.com/blog/2017-07-04-Snip20170705_26.png" alt=""></p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/archives/2017/07/02/2017-07-02-1991027/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="黄鸿亮">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://olmrxx9ks.bkt.clouddn.com/2017-09-07-080115.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Activeliang's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/archives/2017/07/02/2017-07-02-1991027/" itemprop="url">2017-7-2 看菜谱所想……</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-02T10:15:00+08:00">
                2017-07-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h6 id="背景：被做饭这件事虐得生无可恋了。。。"><a href="#背景：被做饭这件事虐得生无可恋了。。。" class="headerlink" title="背景：被做饭这件事虐得生无可恋了。。。"></a>背景：被做饭这件事虐得生无可恋了。。。</h6><blockquote>
<p>打从亚瑱的集体宿舍出来就开始面临一个问题：做饭。</p>
</blockquote>
<h5 id="这也是我就不想干的事情，但又要骗自己去做的事情。"><a href="#这也是我就不想干的事情，但又要骗自己去做的事情。" class="headerlink" title="这也是我就不想干的事情，但又要骗自己去做的事情。"></a>这也是我就不想干的事情，但又要骗自己去做的事情。</h5><p>今天天知乎上教新手怎么做饭的帖子，才发现：</p>
<ul>
<li>肉要怎么切，多长，多厚，多宽，这些全部都有讲究的，不是乱来的！</li>
<li>炒菜前，要用：热锅冷油？热锅热油？二成油温？四成油温？五成？七成？大火爆炒？</li>
<li>要不要勾芡，怎么放粉？</li>
</ul>
<h4 id="天！"><a href="#天！" class="headerlink" title="天！"></a>天！</h4><blockquote>
<p>原来一个菜要炒得好吃，原来这些都不是乱来的，都是有讲究的，以前我炒菜，就只是随便放锅里撩两下，难以下饭，最后得去倒掉！就这样我还骗自己，只要多做就会做得好了……放屁！</p>
<p>你不是学习，不去坚持实践，想成长？放屁！</p>
</blockquote>
<p>好吧，这个就是今天所想：知道得越多，你就越聪明，越有品味！</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/archives/2017/07/02/2017-07-02-1991026/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="黄鸿亮">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://olmrxx9ks.bkt.clouddn.com/2017-09-07-080115.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Activeliang's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/archives/2017/07/02/2017-07-02-1991026/" itemprop="url">2017-7-2 看菜谱所想……</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-02T10:15:00+08:00">
                2017-07-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/archives/2017/06/29/2017-06-29-1982256/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="黄鸿亮">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://olmrxx9ks.bkt.clouddn.com/2017-09-07-080115.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Activeliang's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/archives/2017/06/29/2017-06-29-1982256/" itemprop="url">2017-6-29 《狡猾读书法》读书笔记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-29T01:46:00+08:00">
                2017-06-29
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ol>
<li>读这本书的动机：想知道如何快速通过自考。在元学习课里，xdite有推荐过这本书！最近有参加自考的想法。</li>
</ol>
<h4 id="假如现在我准备自考，学了这个方法，我可以怎么做？"><a href="#假如现在我准备自考，学了这个方法，我可以怎么做？" class="headerlink" title="假如现在我准备自考，学了这个方法，我可以怎么做？"></a>假如现在我准备自考，学了这个方法，我可以怎么做？</h4><p>首先， 明确你不是要考第一名，也不是要100分，你只是想通过考试。然后分两步进行：</p>
<ol>
<li><p>输入练习：找题库，</p>
<ul>
<li>先看答案再看题目（数次）</li>
<li>先看答案+题目，再看解说（数次） （实在看不懂的部分再去看参考书）</li>
</ul>
<h5 id="重复十几次。"><a href="#重复十几次。" class="headerlink" title="重复十几次。"></a>重复十几次。</h5></li>
<li><p>输出练习：还是那本题库。</p>
<ul>
<li>看题目，回想答案（不断练习，以缩短回忆起答案所需时间）</li>
</ul>
<h5 id="花步骤1的两倍时间来练习。"><a href="#花步骤1的两倍时间来练习。" class="headerlink" title="花步骤1的两倍时间来练习。"></a>花步骤1的两倍时间来练习。</h5></li>
</ol>
<blockquote>
<p>这个练习是想让你，花最少的时间，最快的速度，达到：看到题目能快速想起答案。然后用这个粗糙的方法，顺利合格通关。</p>
</blockquote>
<h4 id="练习时，提高记忆力的技巧："><a href="#练习时，提高记忆力的技巧：" class="headerlink" title="练习时，提高记忆力的技巧："></a>练习时，提高记忆力的技巧：</h4><ol>
<li><h5 id="为题目分级："><a href="#为题目分级：" class="headerlink" title="为题目分级："></a>为题目分级：</h5><h6 id="按频率分："><a href="#按频率分：" class="headerlink" title="按频率分："></a>按频率分：</h6><ul>
<li>每年都考：A级；</li>
<li>两年一考：B级；</li>
<li>偶尔考：C级（此考级，可以适当忽略，不会也没有关系）</li>
</ul>
<h6 id="按难度分："><a href="#按难度分：" class="headerlink" title="按难度分："></a>按难度分：</h6><ul>
<li>基础型：++</li>
<li>普通型： +</li>
<li>难度型： —（此考级，可以适当忽略，不会也没有关系）</li>
</ul>
</li>
<li><h5 id="小套路"><a href="#小套路" class="headerlink" title="小套路"></a>小套路</h5><ul>
<li>不记笔记（靠多回想，多输出）</li>
<li>睡前学习</li>
<li>起床后马上回想</li>
<li>睡眠充足</li>
<li>冥想</li>
<li>与喜欢的事情结合（在愉快的情绪下进行~）</li>
<li>每周应有一个下午放假，去做喜欢的，实在的事。</li>
</ul>
</li>
<li><h5 id="学完，找人复述"><a href="#学完，找人复述" class="headerlink" title="学完，找人复述"></a>学完，找人复述</h5><ul>
<li>加深印象！</li>
</ul>
</li>
<li><h5 id="建立知识图库"><a href="#建立知识图库" class="headerlink" title="建立知识图库"></a>建立知识图库</h5><ul>
<li>为知识点找关键词，以A级关键词为中心，外围着相关的关键词（大概10个），当想起中心关键词时，能快速想起整个框架。</li>
</ul>
</li>
<li><h5 id="记忆存取法"><a href="#记忆存取法" class="headerlink" title="记忆存取法"></a>记忆存取法</h5><ul>
<li>睡前5分钟，回想当天学习的内容，只写出条目，但尽量回想细节。</li>
<li>起床后5分钟，回想前一天学习的内容。不记得的要找时间加强记忆。</li>
<li>隔一天后，再次回想</li>
<li>隔两天后，再次回想</li>
<li>隔三天后，再次回想</li>
</ul>
</li>
<li><h5 id="临近考试时，"><a href="#临近考试时，" class="headerlink" title="临近考试时，"></a>临近考试时，</h5><ul>
<li>把带满关键字的题库，一秒一页翻，快速唤醒记忆！（不用读，只是像看整体，回想相关知识点）<ul>
<li>知道这个关键字吗？</li>
<li>是否理解</li>
<li>是否有相关的记忆知识图库</li>
</ul>
</li>
</ul>
</li>
</ol>
<p><img src="http://olmrxx9ks.bkt.clouddn.com/blog/2017-06-29-011323.jpg" alt=""></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/archives/2017/06/22/2017-06-22-kyu/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="黄鸿亮">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://olmrxx9ks.bkt.clouddn.com/2017-09-07-080115.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Activeliang's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/archives/2017/06/22/2017-06-22-kyu/" itemprop="url">Simple_form 如何diy提交路径</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-22T18:19:00+08:00">
                2017-06-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>几经折腾，后来在stackoverfllow看到了满意的答案：</p>
<p><img src="http://olmrxx9ks.bkt.clouddn.com/blog/2017-06-22-181803.jpg" alt=""></p>
<p>参考原文：<a href="https://stackoverflow.com/questions/5181143/simpleform-without-for-non-model-form" target="_blank" rel="external">https://stackoverflow.com/questions/5181143/simpleform-without-for-non-model-form</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/archives/2017/06/22/2017-06-22-2017-6-22-error/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="黄鸿亮">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://olmrxx9ks.bkt.clouddn.com/2017-09-07-080115.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Activeliang's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/archives/2017/06/22/2017-06-22-2017-6-22-error/" itemprop="url">2017-6-22 错误记录</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-22T16:28:00+08:00">
                2017-06-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ol>
<li><p>遇到一个巨大的坑：</p>
<p><img src="http://olmrxx9ks.bkt.clouddn.com/blog/2017-06-22-Snip20170622_2.png" alt=""></p>
<p>数据路由都没有问题，但：</p>
<p><img src="http://olmrxx9ks.bkt.clouddn.com/blog/2017-06-22-Snip20170622_1.png" alt=""></p>
<p>一直提交的路径是错的！！！</p>
</li>
</ol>
<h4 id="最后："><a href="#最后：" class="headerlink" title="最后："></a>最后：</h4><p>原来是开头的form_tag写成form_for了，然后一直跑到create这个action去了，一直提示关键字为空，多么痛的领悟。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/archives/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/archives/">1</a><span class="page-number current">2</span><a class="page-number" href="/archives/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/archives/page/18/">18</a><a class="extend next" rel="next" href="/archives/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          
            <img class="site-author-image" itemprop="image"
              src="http://olmrxx9ks.bkt.clouddn.com/2017-09-07-080115.jpg"
              alt="黄鸿亮" />
          
            <p class="site-author-name" itemprop="name">黄鸿亮</p>
            <p class="site-description motion-element" itemprop="description">记录才能走得更远...</p>
        </div>

        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
            
              <a href="/archives/archives/">
            
                <span class="site-state-item-count">172</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/archives/categories/index.html">
                <span class="site-state-item-count">3</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/archives/tags/index.html">
                <span class="site-state-item-count">3</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">黄鸿亮</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动</div>

  <span class="post-meta-divider">|</span>

  <div class="theme-info">主题 &mdash; <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.2</div>


        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/archives/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/archives/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/archives/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/archives/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/archives/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/archives/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/archives/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/archives/js/src/motion.js?v=5.1.2"></script>



  
  


  <script type="text/javascript" src="/archives/js/src/affix.js?v=5.1.2"></script>

  <script type="text/javascript" src="/archives/js/src/schemes/pisces.js?v=5.1.2"></script>



  <script type="text/javascript" src="/archives/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/archives/js/src/post-details.js?v=5.1.2"></script>


  

  


  <script type="text/javascript" src="/archives/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  








  





  

  

  

  

  

  

</body>
</html>
